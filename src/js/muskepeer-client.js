function q(e){throw e}function y(e,t,n){4!==t.length&&q(new sjcl.exception.invalid("invalid aes block size"));var r=e.b[n],i=t[0]^r[0],o=t[n?3:1]^r[1],s=t[2]^r[2];t=t[n?1:3]^r[3];var u,a,c,l,f=r.length/4-2,d=4,h=[0,0,0,0];u=e.k[n],e=u[0];var p=u[1],g=u[2],m=u[3],v=u[4];for(l=0;f>l;l++)u=e[i>>>24]^p[255&o>>16]^g[255&s>>8]^m[255&t]^r[d],a=e[o>>>24]^p[255&s>>16]^g[255&t>>8]^m[255&i]^r[d+1],c=e[s>>>24]^p[255&t>>16]^g[255&i>>8]^m[255&o]^r[d+2],t=e[t>>>24]^p[255&i>>16]^g[255&o>>8]^m[255&s]^r[d+3],d+=4,i=u,o=a,s=c;for(l=0;4>l;l++)h[n?3&-l:l]=v[i>>>24]<<24^v[255&o>>16]<<16^v[255&s>>8]<<8^v[255&t]^r[d++],u=i,i=o,o=s,s=t,t=u;return h}function z(e,t){var n,r,i,o=t.slice(0),s=e.r,u=e.b,a=s[0],c=s[1],l=s[2],f=s[3],d=s[4],h=s[5],p=s[6],g=s[7];for(n=0;64>n;n++)16>n?r=o[n]:(r=o[15&n+1],i=o[15&n+14],r=o[15&n]=0|(r>>>7^r>>>18^r>>>3^r<<25^r<<14)+(i>>>17^i>>>19^i>>>10^i<<15^i<<13)+o[15&n]+o[15&n+9]),r=r+g+(d>>>6^d>>>11^d>>>25^d<<26^d<<21^d<<7)+(p^d&(h^p))+u[n],g=p,p=h,h=d,d=0|f+r,f=l,l=c,c=a,a=0|r+(c&l^f&(c^l))+(c>>>2^c>>>13^c>>>22^c<<30^c<<19^c<<10);s[0]=0|s[0]+a,s[1]=0|s[1]+c,s[2]=0|s[2]+l,s[3]=0|s[3]+f,s[4]=0|s[4]+d,s[5]=0|s[5]+h,s[6]=0|s[6]+p,s[7]=0|s[7]+g}function C(e,t){var n,r=sjcl.random.w[e],i=[];for(n in r)r.hasOwnProperty(n)&&i.push(r[n]);for(n=0;n<i.length;n++)i[n](t)}function E(e){window&&window.performance&&"function"==typeof window.performance.now?sjcl.random.addEntropy(window.performance.now(),e,"loadtime"):sjcl.random.addEntropy((new Date).valueOf(),e,"loadtime")}function A(e){e.b=B(e).concat(B(e)),e.A=new sjcl.cipher.aes(e.b)}function B(e){for(var t=0;4>t&&(e.f[t]=0|e.f[t]+1,!e.f[t]);t++);return e.A.encrypt(e.f)}function D(e,t){return function(){t.apply(e,arguments)}}(function(){function e(e,t,n){for(var r=(n||0)-1,i=e?e.length:0;++r<i;)if(e[r]===t)return r;return-1}function t(t,n){var r=typeof n;if(t=t.cache,"boolean"==r||null==n)return t[n]?0:-1;"number"!=r&&"string"!=r&&(r="object");var i="number"==r?n:y+n;return t=(t=t[r])&&t[i],"object"==r?t&&e(t,n)>-1?0:-1:t?0:-1}function n(e){var t=this.cache,n=typeof e;if("boolean"==n||null==e)t[e]=!0;else{"number"!=n&&"string"!=n&&(n="object");var r="number"==n?e:y+e,i=t[n]||(t[n]={});"object"==n?(i[r]||(i[r]=[])).push(e):i[r]=!0}}function r(e){return e.charCodeAt(0)}function i(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||"undefined"==typeof n)return 1;if(r>n||"undefined"==typeof r)return-1}return e.index-t.index}function o(e){var t=-1,r=e.length,i=e[0],o=e[0|r/2],s=e[r-1];if(i&&"object"==typeof i&&o&&"object"==typeof o&&s&&"object"==typeof s)return!1;var u=a();u["false"]=u["null"]=u["true"]=u.undefined=!1;var c=a();for(c.array=e,c.cache=u,c.push=n;++t<r;)c.push(e[t]);return c}function s(e){return"\\"+$[e]}function u(){return g.pop()||[]}function a(){return m.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function c(){}function l(e){e.length=0,g.length<w&&g.push(e)}function f(e){var t=e.cache;t&&f(t),e.array=e.cache=e.criteria=e.object=e.number=e.string=e.value=null,m.length<w&&m.push(e)}function d(e,t,n){t||(t=0),"undefined"==typeof n&&(n=e?e.length:0);for(var r=-1,i=n-t||0,o=Array(0>i?0:i);++r<i;)o[r]=e[t+r];return o}function h(n){function g(e){return e&&"object"==typeof e&&!Yr(e)&&Er.call(e,"__wrapped__")?e:new m(e)}function m(e,t){this.__chain__=!!t,this.__wrapped__=e}function w(e,t,n,r,i){if(n){var o=n(e);if("undefined"!=typeof o)return o}var s=xt(e);if(!s)return e;var a=Nr.call(e);if(!V[a])return e;var c=Wr[a];switch(a){case U:case T:return new c(+e);case z:case H:return new c(e);case M:return o=c(e.source,x.exec(e)),o.lastIndex=e.lastIndex,o}var f=Yr(e);if(t){var h=!r;r||(r=u()),i||(i=u());for(var p=r.length;p--;)if(r[p]==e)return i[p];o=f?c(e.length):{}}else o=f?d(e):ri({},e);return f&&(Er.call(e,"index")&&(o.index=e.index),Er.call(e,"input")&&(o.input=e.input)),t?(r.push(e),i.push(o),(f?Jt:si)(e,function(e,s){o[s]=w(e,t,n,r,i)}),h&&(l(r),l(i)),o):o}function $(e,t,n){if("function"!=typeof e)return Gn;if("undefined"==typeof t)return e;var r=e.__bindData__||$r.funcNames&&!e.name;if("undefined"==typeof r){var i=N&&kr.call(e);$r.funcNames||!i||R.test(i)||(r=!0),($r.funcNames||!r)&&(r=!$r.funcDecomp||N.test(i),Kr(e,r))}if(r!==!0&&r&&1&r[1])return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,o){return e.call(t,n,r,i,o)}}return Cn(e,t)}function Y(e,t,n,r){for(var i=(r||0)-1,o=e?e.length:0,s=[];++i<o;){var u=e[i];if(u&&"object"==typeof u&&"number"==typeof u.length&&(Yr(u)||ct(u))){t||(u=Y(u,t,n));var a=-1,c=u.length,l=s.length;for(s.length+=c;++a<c;)s[l++]=u[a]}else n||s.push(u)}return s}function X(e,t,n,r,i,o){if(n){var s=n(e,t);if("undefined"!=typeof s)return!!s}if(e===t)return 0!==e||1/e==1/t;var a=typeof e,c=typeof t;if(!(e!==e||e&&W[a]||t&&W[c]))return!1;if(null==e||null==t)return e===t;var f=Nr.call(e),d=Nr.call(t);if(f==D&&(f=F),d==D&&(d=F),f!=d)return!1;switch(f){case U:case T:return+e==+t;case z:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case M:case H:return e==pr(t)}var h=f==O;if(!h){if(Er.call(e,"__wrapped__ ")||Er.call(t,"__wrapped__"))return X(e.__wrapped__||e,t.__wrapped__||t,n,r,i,o);if(f!=F)return!1;var p=e.constructor,g=t.constructor;if(p!=g&&!(Et(p)&&p instanceof p&&Et(g)&&g instanceof g))return!1}var m=!i;i||(i=u()),o||(o=u());for(var v=i.length;v--;)if(i[v]==e)return o[v]==t;var y=0;if(s=!0,i.push(e),o.push(t),h){if(v=e.length,y=t.length,s=y==e.length,!s&&!r)return s;for(;y--;){var b=v,w=t[y];if(r)for(;b--&&!(s=X(e[b],w,n,r,i,o)););else if(!(s=X(e[y],w,n,r,i,o)))break}return s}return oi(t,function(t,u,a){return Er.call(a,u)?(y++,s=Er.call(e,u)&&X(e[u],t,n,r,i,o)):void 0}),s&&!r&&oi(e,function(e,t,n){return Er.call(n,t)?s=--y>-1:void 0}),m&&(l(i),l(o)),s}function Z(e,t,n,r,i){(Yr(t)?Jt:si)(t,function(t,o){var s,u,a=t,c=e[o];if(t&&((u=Yr(t))||ui(t))){for(var l=r.length;l--;)if(s=r[l]==t){c=i[l];break}if(!s){var f;n&&(a=n(c,t),(f="undefined"!=typeof a)&&(c=a)),f||(c=u?Yr(c)?c:[]:ui(c)?c:{}),r.push(t),i.push(c),f||Z(c,t,n,r,i)}}else n&&(a=n(c,t),"undefined"==typeof a&&(a=t)),"undefined"!=typeof a&&(c=a);e[o]=c})}function tt(n,r,i){var s=-1,a=st(),c=n?n.length:0,d=[],h=!r&&c>=b&&a===e,p=i||h?u():d;if(h){var g=o(p);g?(a=t,p=g):(h=!1,p=i?p:(l(p),d))}for(;++s<c;){var m=n[s],v=i?i(m,s,n):m;(r?!s||p[p.length-1]!==v:a(p,v)<0)&&((i||h)&&p.push(v),d.push(m))}return h?(l(p.array),f(p)):i&&l(p),d}function nt(e){return function(t,n,r){var i={};n=g.createCallback(n,r,3);var o=-1,s=t?t.length:0;if("number"==typeof s)for(;++o<s;){var u=t[o];e(i,u,n(u,o,t),t)}else si(t,function(t,r,o){e(i,t,n(t,r,o),o)});return i}}function rt(e,t,n,r,i,o){var s=1&t,u=2&t,a=4&t,c=8&t,l=16&t,f=32&t,d=e;if(!u&&!Et(e))throw new gr;l&&!n.length&&(t&=-17,l=n=!1),f&&!r.length&&(t&=-33,f=r=!1);var h=e&&e.__bindData__;if(h)return!s||1&h[1]||(h[4]=i),!s&&1&h[1]&&(t|=8),!a||4&h[1]||(h[5]=o),l&&Rr.apply(h[2]||(h[2]=[]),n),f&&Rr.apply(h[3]||(h[3]=[]),r),h[1]|=t,rt.apply(null,h);if(!s||u||a||f||!($r.fastBind||Ir&&l))g=function(){var h=arguments,p=s?i:this;if((a||l||f)&&(h=Vr.call(h),l&&Lr.apply(h,n),f&&Rr.apply(h,r),a&&h.length<o))return t|=16,rt(e,c?t:-4&t,h,null,i,o);if(u&&(e=p[d]),this instanceof g){p=it(e.prototype);var m=e.apply(p,h);return xt(m)?m:p}return e.apply(p,h)};else{if(l){var p=[i];Rr.apply(p,n)}var g=l?Ir.apply(e,p):Ir.call(e,i)}return Kr(g,Vr.call(arguments)),g}function it(e){return xt(e)?Dr(e):{}}function ot(e){return Zr[e]}function st(){var t=(t=g.indexOf)===pn?e:t;return t}function ut(e){var t,n;return e&&Nr.call(e)==F&&(t=e.constructor,!Et(t)||t instanceof t)?(oi(e,function(e,t){n=t}),"undefined"==typeof n||Er.call(e,n)):!1}function at(e){return ei[e]}function ct(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Nr.call(e)==D||!1}function lt(e,t,n,r){return"boolean"!=typeof t&&null!=t&&(r=n,n=t,t=!1),w(e,t,"function"==typeof n&&$(n,r,1))}function ft(e,t,n){return w(e,!0,"function"==typeof t&&$(t,n,1))}function dt(e,t,n){var r;return t=g.createCallback(t,n,3),si(e,function(e,n,i){return t(e,n,i)?(r=n,!1):void 0}),r}function ht(e,t,n){var r;return t=g.createCallback(t,n,3),gt(e,function(e,n,i){return t(e,n,i)?(r=n,!1):void 0}),r}function pt(e,t,n){var r=[];oi(e,function(e,t){r.push(t,e)});var i=r.length;for(t=$(t,n,3);i--&&t(r[i--],r[i],e)!==!1;);return e}function gt(e,t,n){var r=Qr(e),i=r.length;for(t=$(t,n,3);i--;){var o=r[i];if(t(e[o],o,e)===!1)break}return e}function mt(e){var t=[];return oi(e,function(e,n){Et(e)&&t.push(n)}),t.sort()}function vt(e,t){return e?Er.call(e,t):!1}function yt(e){for(var t=-1,n=Qr(e),r=n.length,i={};++t<r;){var o=n[t];i[e[o]]=o}return i}function bt(e){return e===!0||e===!1||Nr.call(e)==U}function wt(e){return e?"object"==typeof e&&Nr.call(e)==T:!1}function jt(e){return e?1===e.nodeType:!1}function _t(e){var t=!0;if(!e)return t;var n=Nr.call(e),r=e.length;return n==O||n==H||n==D||n==F&&"number"==typeof r&&Et(e.splice)?!r:(si(e,function(){return t=!1}),t)}function kt(e,t,n,r){return X(e,t,"function"==typeof n&&$(n,r,2))}function At(e){return Ur(e)&&!Tr(parseFloat(e))}function Et(e){return"function"==typeof e}function xt(e){return!(!e||!W[typeof e])}function Rt(e){return Pt(e)&&e!=+e}function St(e){return null===e}function Pt(e){return"number"==typeof e||Nr.call(e)==z}function Ct(e){return e?"object"==typeof e&&Nr.call(e)==M:!1}function Nt(e){return"string"==typeof e||Nr.call(e)==H}function Lt(e){return"undefined"==typeof e}function Bt(e){var t=arguments,n=2;if(!xt(e))return e;if("number"!=typeof t[2]&&(n=t.length),n>3&&"function"==typeof t[n-2])var r=$(t[--n-1],t[n--],2);else n>2&&"function"==typeof t[n-1]&&(r=t[--n]);for(var i=Vr.call(arguments,1,n),o=-1,s=u(),a=u();++o<n;)Z(e,i[o],r,s,a);return l(s),l(a),e}function It(e,t,n){var r=st(),i="function"==typeof t,o={};if(i)t=g.createCallback(t,n,3);else var s=Y(arguments,!0,!1,1);return oi(e,function(e,n,u){(i?!t(e,n,u):r(s,n)<0)&&(o[n]=e)}),o}function Dt(e){for(var t=-1,n=Qr(e),r=n.length,i=sr(r);++t<r;){var o=n[t];i[t]=[o,e[o]]}return i}function Ot(e,t,n){var r={};if("function"!=typeof t)for(var i=-1,o=Y(arguments,!0,!1,1),s=xt(e)?o.length:0;++i<s;){var u=o[i];u in e&&(r[u]=e[u])}else t=g.createCallback(t,n,3),oi(e,function(e,n,i){t(e,n,i)&&(r[n]=e)});return r}function Ut(e,t,n,r){var i=Yr(e);if(t=$(t,r,4),null==n)if(i)n=[];else{var o=e&&e.constructor,s=o&&o.prototype;n=it(s)}return(i?Jt:si)(e,function(e,r,i){return t(n,e,r,i)}),n}function Tt(e){for(var t=-1,n=Qr(e),r=n.length,i=sr(r);++t<r;)i[t]=e[n[t]];return i}function qt(e){for(var t=arguments,n=-1,r=Y(t,!0,!1,1),i=t[2]&&t[2][t[1]]===e?1:r.length,o=sr(i);++n<i;)o[n]=e[r[n]];return o}function zt(e,t,n){var r=-1,i=st(),o=e?e.length:0,s=!1;return n=(0>n?zr(0,o+n):n)||0,Yr(e)?s=i(e,t,n)>-1:"number"==typeof o?s=(Nt(e)?e.indexOf(t,n):i(e,t,n))>-1:si(e,function(e){return++r>=n?!(s=e===t):void 0}),s}function Ft(e,t,n){var r=!0;t=g.createCallback(t,n,3);var i=-1,o=e?e.length:0;if("number"==typeof o)for(;++i<o&&(r=!!t(e[i],i,e)););else si(e,function(e,n,i){return r=!!t(e,n,i)});return r}function Mt(e,t,n){var r=[];t=g.createCallback(t,n,3);var i=-1,o=e?e.length:0;if("number"==typeof o)for(;++i<o;){var s=e[i];t(s,i,e)&&r.push(s)}else si(e,function(e,n,i){t(e,n,i)&&r.push(e)});return r}function Ht(e,t,n){t=g.createCallback(t,n,3);var r=-1,i=e?e.length:0;if("number"!=typeof i){var o;return si(e,function(e,n,r){return t(e,n,r)?(o=e,!1):void 0}),o}for(;++r<i;){var s=e[r];if(t(s,r,e))return s}}function Vt(e,t,n){var r;return t=g.createCallback(t,n,3),Gt(e,function(e,n,i){return t(e,n,i)?(r=e,!1):void 0}),r}function Jt(e,t,n){var r=-1,i=e?e.length:0;if(t=t&&"undefined"==typeof n?t:$(t,n,3),"number"==typeof i)for(;++r<i&&t(e[r],r,e)!==!1;);else si(e,t);return e}function Gt(e,t,n){var r=e?e.length:0;if(t=t&&"undefined"==typeof n?t:$(t,n,3),"number"==typeof r)for(;r--&&t(e[r],r,e)!==!1;);else{var i=Qr(e);r=i.length,si(e,function(e,n,o){return n=i?i[--r]:--r,t(o[n],n,o)})}return e}function Wt(e,t){var n=Vr.call(arguments,2),r=-1,i="function"==typeof t,o=e?e.length:0,s=sr("number"==typeof o?o:0);return Jt(e,function(e){s[++r]=(i?t:e[t]).apply(e,n)}),s}function $t(e,t,n){var r=-1,i=e?e.length:0;if(t=g.createCallback(t,n,3),"number"==typeof i)for(var o=sr(i);++r<i;)o[r]=t(e[r],r,e);else o=[],si(e,function(e,n,i){o[++r]=t(e,n,i)});return o}function Kt(e,t,n){var i=-1/0,o=i;if(!t&&Yr(e))for(var s=-1,u=e.length;++s<u;){var a=e[s];a>o&&(o=a)}else t=!t&&Nt(e)?r:g.createCallback(t,n,3),Jt(e,function(e,n,r){var s=t(e,n,r);s>i&&(i=s,o=e)});return o}function Yt(e,t,n){var i=1/0,o=i;if(!t&&Yr(e))for(var s=-1,u=e.length;++s<u;){var a=e[s];o>a&&(o=a)}else t=!t&&Nt(e)?r:g.createCallback(t,n,3),Jt(e,function(e,n,r){var s=t(e,n,r);i>s&&(i=s,o=e)});return o}function Xt(e,t){var n=-1,r=e?e.length:0;if("number"==typeof r)for(var i=sr(r);++n<r;)i[n]=e[n][t];return i||$t(e,t)}function Qt(e,t,n,r){if(!e)return n;var i=arguments.length<3;t=$(t,r,4);var o=-1,s=e.length;if("number"==typeof s)for(i&&(n=e[++o]);++o<s;)n=t(n,e[o],o,e);else si(e,function(e,r,o){n=i?(i=!1,e):t(n,e,r,o)});return n}function Zt(e,t,n,r){var i=arguments.length<3;return t=$(t,r,4),Gt(e,function(e,r,o){n=i?(i=!1,e):t(n,e,r,o)}),n}function en(e,t,n){return t=g.createCallback(t,n,3),Mt(e,function(e,n,r){return!t(e,n,r)})}function tn(e,t,n){var r=e?e.length:0;if("number"!=typeof r&&(e=Tt(e)),null==t||n)return e?e[Kn(r-1)]:p;var i=nn(e);return i.length=Fr(zr(0,t),i.length),i}function nn(e){var t=-1,n=e?e.length:0,r=sr("number"==typeof n?n:0);return Jt(e,function(e){var n=Kn(++t);r[t]=r[n],r[n]=e}),r}function rn(e){var t=e?e.length:0;return"number"==typeof t?t:Qr(e).length}function on(e,t,n){var r;t=g.createCallback(t,n,3);var i=-1,o=e?e.length:0;if("number"==typeof o)for(;++i<o&&!(r=t(e[i],i,e)););else si(e,function(e,n,i){return!(r=t(e,n,i))});return!!r}function sn(e,t,n){var r=-1,o=e?e.length:0,s=sr("number"==typeof o?o:0);for(t=g.createCallback(t,n,3),Jt(e,function(e,n,i){var o=s[++r]=a();o.criteria=t(e,n,i),o.index=r,o.value=e}),o=s.length,s.sort(i);o--;){var u=s[o];s[o]=u.value,f(u)}return s}function un(e){return e&&"number"==typeof e.length?d(e):Tt(e)}function an(e){for(var t=-1,n=e?e.length:0,r=[];++t<n;){var i=e[t];i&&r.push(i)}return r}function cn(n){var r=-1,i=st(),s=n?n.length:0,u=Y(arguments,!0,!0,1),a=[],c=s>=b&&i===e;if(c){var l=o(u);l?(i=t,u=l):c=!1}for(;++r<s;){var d=n[r];i(u,d)<0&&a.push(d)}return c&&f(u),a}function ln(e,t,n){var r=-1,i=e?e.length:0;for(t=g.createCallback(t,n,3);++r<i;)if(t(e[r],r,e))return r;return-1}function fn(e,t,n){var r=e?e.length:0;for(t=g.createCallback(t,n,3);r--;)if(t(e[r],r,e))return r;return-1}function dn(e,t,n){var r=0,i=e?e.length:0;if("number"!=typeof t&&null!=t){var o=-1;for(t=g.createCallback(t,n,3);++o<i&&t(e[o],o,e);)r++}else if(r=t,null==r||n)return e?e[0]:p;return d(e,0,Fr(zr(0,r),i))}function hn(e,t,n,r){return"boolean"!=typeof t&&null!=t&&(r=n,n=r&&r[t]===e?null:t,t=!1),null!=n&&(e=$t(e,n,r)),Y(e,t)}function pn(t,n,r){if("number"==typeof r){var i=t?t.length:0;r=0>r?zr(0,i+r):r||0}else if(r){var o=kn(t,n);return t[o]===n?o:-1}return e(t,n,r)}function gn(e,t,n){var r=0,i=e?e.length:0;if("number"!=typeof t&&null!=t){var o=i;for(t=g.createCallback(t,n,3);o--&&t(e[o],o,e);)r++}else r=null==t||n?1:t||r;return d(e,0,Fr(zr(0,i-r),i))}function mn(n){for(var r=arguments,i=r.length,s=-1,a=u(),c=-1,d=st(),h=n?n.length:0,p=[],g=u();++s<i;){var m=r[s];a[s]=d===e&&(m?m.length:0)>=b&&o(s?r[s]:g)}e:for(;++c<h;){var v=a[0];if(m=n[c],(v?t(v,m):d(g,m))<0){for(s=i,(v||g).push(m);--s;)if(v=a[s],(v?t(v,m):d(r[s],m))<0)continue e;p.push(m)}}for(;i--;)v=a[i],v&&f(v);return l(a),l(g),p}function vn(e,t,n){var r=0,i=e?e.length:0;if("number"!=typeof t&&null!=t){var o=i;for(t=g.createCallback(t,n,3);o--&&t(e[o],o,e);)r++}else if(r=t,null==r||n)return e?e[i-1]:p;return d(e,zr(0,i-r))}function yn(e,t,n){var r=e?e.length:0;for("number"==typeof n&&(r=(0>n?zr(0,r+n):Fr(n,r-1))+1);r--;)if(e[r]===t)return r;return-1}function bn(e){for(var t=arguments,n=0,r=t.length,i=e?e.length:0;++n<r;)for(var o=-1,s=t[n];++o<i;)e[o]===s&&(Cr.call(e,o--,1),i--);return e}function wn(e,t,n){e=+e||0,n="number"==typeof n?n:+n||1,null==t&&(t=e,e=0);for(var r=-1,i=zr(0,wr((t-e)/(n||1))),o=sr(i);++r<i;)o[r]=e,e+=n;return o}function jn(e,t,n){var r=-1,i=e?e.length:0,o=[];for(t=g.createCallback(t,n,3);++r<i;){var s=e[r];t(s,r,e)&&(o.push(s),Cr.call(e,r--,1),i--)}return o}function _n(e,t,n){if("number"!=typeof t&&null!=t){var r=0,i=-1,o=e?e.length:0;for(t=g.createCallback(t,n,3);++i<o&&t(e[i],i,e);)r++}else r=null==t||n?1:zr(0,t);return d(e,r)}function kn(e,t,n,r){var i=0,o=e?e.length:i;for(n=n?g.createCallback(n,r,1):Gn,t=n(t);o>i;){var s=i+o>>>1;n(e[s])<t?i=s+1:o=s}return i}function An(){return tt(Y(arguments,!0,!0))}function En(e,t,n,r){return"boolean"!=typeof t&&null!=t&&(r=n,n=r&&r[t]===e?null:t,t=!1),null!=n&&(n=g.createCallback(n,r,3)),tt(e,t,n)}function xn(e){return cn(e,Vr.call(arguments,1))}function Rn(){for(var e=arguments.length>1?arguments:arguments[0],t=-1,n=e?Kt(Xt(e,"length")):0,r=sr(0>n?0:n);++t<n;)r[t]=Xt(e,t);return r}function Sn(e,t){for(var n=-1,r=e?e.length:0,i={};++n<r;){var o=e[n];t?i[o]=t[n]:o&&(i[o[0]]=o[1])}return i}function Pn(e,t){if(!Et(t))throw new gr;return function(){return--e<1?t.apply(this,arguments):void 0}}function Cn(e,t){return arguments.length>2?rt(e,17,Vr.call(arguments,2),null,t):rt(e,1,null,null,t)}function Nn(e){for(var t=arguments.length>1?Y(arguments,!0,!1,1):mt(e),n=-1,r=t.length;++n<r;){var i=t[n];e[i]=rt(e[i],1,null,null,e)}return e}function Ln(e,t){return arguments.length>2?rt(t,19,Vr.call(arguments,2),null,e):rt(t,3,null,null,e)}function Bn(){for(var e=arguments,t=e.length;t--;)if(!Et(e[t]))throw new gr;return function(){for(var t=arguments,n=e.length;n--;)t=[e[n].apply(this,t)];return t[0]}}function In(e,t,n){var r=typeof e;if(null==e||"function"==r)return $(e,t,n);if("object"!=r)return function(t){return t[e]};var i=Qr(e),o=i[0],s=e[o];return 1!=i.length||s!==s||xt(s)?function(t){for(var n=i.length,r=!1;n--&&(r=X(t[i[n]],e[i[n]],null,!0)););return r}:function(e){var t=e[o];return s===t&&(0!==s||1/s==1/t)}}function Dn(e,t){return t="number"==typeof t?t:+t||e.length,rt(e,4,null,null,null,t)}function On(e,t,n){var r,i,o,s,u,a,c,l=0,f=!1,d=!0;if(!Et(e))throw new gr;if(t=zr(0,t)||0,n===!0){var h=!0;d=!1}else xt(n)&&(h=n.leading,f="maxWait"in n&&(zr(t,n.maxWait)||0),d="trailing"in n?n.trailing:d);var g=function(){var n=t-(xr()-s);if(0>=n){i&&jr(i);var f=c;i=a=c=p,f&&(l=xr(),o=e.apply(u,r))}else a=Pr(g,n)},m=function(){a&&jr(a),i=a=c=p,(d||f!==t)&&(l=xr(),o=e.apply(u,r))};return function(){if(r=arguments,s=xr(),u=this,c=d&&(a||!h),f===!1)var n=h&&!a;else{i||h||(l=s);var p=f-(s-l);0>=p?(i&&(i=jr(i)),l=s,o=e.apply(u,r)):i||(i=Pr(m,p))}return a||t===f||(a=Pr(g,t)),n&&(o=e.apply(u,r)),o}}function Un(e){if(!Et(e))throw new gr;var t=Vr.call(arguments,1);return Pr(function(){e.apply(p,t)},1)}function Tn(e,t){if(!Et(e))throw new gr;var n=Vr.call(arguments,2);return Pr(function(){e.apply(p,n)},t)}function qn(e,t){if(!Et(e))throw new gr;var n=function(){var r=n.cache,i=t?t.apply(this,arguments):y+arguments[0];return Er.call(r,i)?r[i]:r[i]=e.apply(this,arguments)};return n.cache={},n}function zn(e){var t,n;if(!Et(e))throw new gr;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}}function Fn(e){return rt(e,16,Vr.call(arguments,1))}function Mn(e){return rt(e,32,null,Vr.call(arguments,1))}function Hn(e,t,n){var r=!0,i=!0;if(!Et(e))throw new gr;n===!1?r=!1:xt(n)&&(r="leading"in n?n.leading:r,i="trailing"in n?n.trailing:i),J.leading=r,J.maxWait=t,J.trailing=i;var o=On(e,t,J);return o}function Vn(e,t){if(!Et(t))throw new gr;return function(){var n=[e];return Rr.apply(n,arguments),t.apply(this,n)}}function Jn(e){return null==e?"":pr(e).replace(ni,ot)}function Gn(e){return e}function Wn(e,t){var n=e,r=!t||Et(n);t||(n=m,t=e,e=g),Jt(mt(t),function(i){var o=e[i]=t[i];r&&(n.prototype[i]=function(){var t=this.__wrapped__,r=[t];Rr.apply(r,arguments);var i=o.apply(e,r);return t&&"object"==typeof t&&t===i?this:(i=new n(i),i.__chain__=this.__chain__,i)})})}function $n(){return n._=yr,this}function Kn(e,t,n){var r=null==e,i=null==t;null==n&&("boolean"==typeof e&&i?(n=e,e=1):i||"boolean"!=typeof t||(n=t,i=!0)),r&&i&&(t=1),e=+e||0,i?(t=e,e=0):t=+t||0;var o=Hr();return n||e%1||t%1?Fr(e+o*(t-e+parseFloat("1e-"+((o+"").length-1))),t):e+_r(o*(t-e+1))}function Yn(e,t){if(e){var n=e[t];return Et(n)?e[t]():n}}function Xn(e,t,n){var r=g.templateSettings;e||(e=""),n=ii({},n,r);var i,o=ii({},n.imports,r.imports),u=Qr(o),a=Tt(o),c=0,l=n.interpolate||C,f="__p += '",d=hr((n.escape||C).source+"|"+l.source+"|"+(l===S?E:C).source+"|"+(n.evaluate||C).source+"|$","g");e.replace(d,function(t,n,r,o,u,a){return r||(r=o),f+=e.slice(c,a).replace(L,s),n&&(f+="' +\n__e("+n+") +\n'"),u&&(i=!0,f+="';\n"+u+";\n__p += '"),r&&(f+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),c=a+t.length,t}),f+="';\n";var h=n.variable,m=h;m||(h="obj",f="with ("+h+") {\n"+f+"\n}\n"),f=(i?f.replace(_,""):f).replace(k,"$1").replace(A,"$1;"),f="function("+h+") {\n"+(m?"":h+" || ("+h+" = {});\n")+"var __t, __p = '', __e = _.escape"+(i?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var v="\n/*\n//# sourceURL="+(n.sourceURL||"/lodash/template/source["+I++ +"]")+"\n*/";try{var y=cr(u,"return "+f+v).apply(p,a)}catch(b){throw b.source=f,b}return t?y(t):(y.source=f,y)}function Qn(e,t,n){e=(e=+e)>-1?e:0;var r=-1,i=sr(e);for(t=$(t,n,1);++r<e;)i[r]=t(r);return i}function Zn(e){return null==e?"":pr(e).replace(ti,at)}function er(e){var t=++v;return pr(null==e?"":e)+t}function tr(e){return e=new m(e),e.__chain__=!0,e}function nr(e,t){return t(e),e}function rr(){return this.__chain__=!0,this}function ir(){return pr(this.__wrapped__)}function or(){return this.__wrapped__}n=n?et.defaults(K.Object(),n,et.pick(K,B)):K;var sr=n.Array,ur=n.Boolean,ar=n.Date,cr=n.Function,lr=n.Math,fr=n.Number,dr=n.Object,hr=n.RegExp,pr=n.String,gr=n.TypeError,mr=[],vr=dr.prototype,yr=n._,br=hr("^"+pr(vr.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),wr=lr.ceil,jr=n.clearTimeout,_r=lr.floor,kr=cr.prototype.toString,Ar=br.test(Ar=dr.getPrototypeOf)&&Ar,Er=vr.hasOwnProperty,xr=br.test(xr=ar.now)&&xr||function(){return+new ar},Rr=mr.push,Sr=n.setImmediate,Pr=n.setTimeout,Cr=mr.splice,Nr=vr.toString,Lr=mr.unshift,Br=function(){try{var e={},t=br.test(t=dr.defineProperty)&&t,n=t(e,e,e)&&t}catch(r){}return n}(),Ir=br.test(Ir=Nr.bind)&&Ir,Dr=br.test(Dr=dr.create)&&Dr,Or=br.test(Or=sr.isArray)&&Or,Ur=n.isFinite,Tr=n.isNaN,qr=br.test(qr=dr.keys)&&qr,zr=lr.max,Fr=lr.min,Mr=n.parseInt,Hr=lr.random,Vr=mr.slice,Jr=br.test(n.attachEvent),Gr=Ir&&!/\n|true/.test(Ir+Jr),Wr={};Wr[O]=sr,Wr[U]=ur,Wr[T]=ar,Wr[q]=cr,Wr[F]=dr,Wr[z]=fr,Wr[M]=hr,Wr[H]=pr,m.prototype=g.prototype;var $r=g.support={};$r.fastBind=Ir&&!Gr,$r.funcDecomp=!br.test(n.WinRTError)&&N.test(h),$r.funcNames="string"==typeof cr.name,g.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:S,variable:"",imports:{_:g}},Dr||(it=function(e){if(xt(e)){c.prototype=e;var t=new c;c.prototype=null}return t||{}});var Kr=Br?function(e,t){G.value=t,Br(e,"__bindData__",G)}:c,Yr=Or||function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Nr.call(e)==O||!1},Xr=function(e){var t,n=e,r=[];if(!n)return r;if(!W[typeof e])return r;for(t in n)Er.call(n,t)&&r.push(t);return r},Qr=qr?function(e){return xt(e)?qr(e):[]}:Xr,Zr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ei=yt(Zr),ti=hr("("+Qr(ei).join("|")+")","g"),ni=hr("["+Qr(Zr).join("")+"]","g"),ri=function(e,t,n){var r,i=e,o=i;if(!i)return o;var s=arguments,u=0,a="number"==typeof n?2:s.length;if(a>3&&"function"==typeof s[a-2])var c=$(s[--a-1],s[a--],2);else a>2&&"function"==typeof s[a-1]&&(c=s[--a]);for(;++u<a;)if(i=s[u],i&&W[typeof i])for(var l=-1,f=W[typeof i]&&Qr(i),d=f?f.length:0;++l<d;)r=f[l],o[r]=c?c(o[r],i[r]):i[r];return o},ii=function(e,t,n){var r,i=e,o=i;if(!i)return o;for(var s=arguments,u=0,a="number"==typeof n?2:s.length;++u<a;)if(i=s[u],i&&W[typeof i])for(var c=-1,l=W[typeof i]&&Qr(i),f=l?l.length:0;++c<f;)r=l[c],"undefined"==typeof o[r]&&(o[r]=i[r]);return o},oi=function(e,t,n){var r,i=e,o=i;if(!i)return o;if(!W[typeof i])return o;t=t&&"undefined"==typeof n?t:$(t,n,3);for(r in i)if(t(i[r],r,e)===!1)return o;return o},si=function(e,t,n){var r,i=e,o=i;if(!i)return o;if(!W[typeof i])return o;t=t&&"undefined"==typeof n?t:$(t,n,3);for(var s=-1,u=W[typeof i]&&Qr(i),a=u?u.length:0;++s<a;)if(r=u[s],t(i[r],r,e)===!1)return o;return o},ui=function(e){if(!e||Nr.call(e)!=F)return!1;var t=e.valueOf,n="function"==typeof t&&(n=Ar(t))&&Ar(n);return n?e==n||Ar(e)==n:ut(e)},ai=nt(function(e,t,n){Er.call(e,n)?e[n]++:e[n]=1}),ci=nt(function(e,t,n){(Er.call(e,n)?e[n]:e[n]=[]).push(t)}),li=nt(function(e,t,n){e[n]=t}),fi=Mt;Gr&&Q&&"function"==typeof Sr&&(Un=function(e){if(!Et(e))throw new gr;return Sr.apply(n,arguments)});var di=8==Mr(j+"08")?Mr:function(e,t){return Mr(Nt(e)?e.replace(P,""):e,t||0)};return g.after=Pn,g.assign=ri,g.at=qt,g.bind=Cn,g.bindAll=Nn,g.bindKey=Ln,g.chain=tr,g.compact=an,g.compose=Bn,g.countBy=ai,g.createCallback=In,g.curry=Dn,g.debounce=On,g.defaults=ii,g.defer=Un,g.delay=Tn,g.difference=cn,g.filter=Mt,g.flatten=hn,g.forEach=Jt,g.forEachRight=Gt,g.forIn=oi,g.forInRight=pt,g.forOwn=si,g.forOwnRight=gt,g.functions=mt,g.groupBy=ci,g.indexBy=li,g.initial=gn,g.intersection=mn,g.invert=yt,g.invoke=Wt,g.keys=Qr,g.map=$t,g.max=Kt,g.memoize=qn,g.merge=Bt,g.min=Yt,g.omit=It,g.once=zn,g.pairs=Dt,g.partial=Fn,g.partialRight=Mn,g.pick=Ot,g.pluck=Xt,g.pull=bn,g.range=wn,g.reject=en,g.remove=jn,g.rest=_n,g.shuffle=nn,g.sortBy=sn,g.tap=nr,g.throttle=Hn,g.times=Qn,g.toArray=un,g.transform=Ut,g.union=An,g.uniq=En,g.values=Tt,g.where=fi,g.without=xn,g.wrap=Vn,g.zip=Rn,g.zipObject=Sn,g.collect=$t,g.drop=_n,g.each=Jt,g.eachRight=Gt,g.extend=ri,g.methods=mt,g.object=Sn,g.select=Mt,g.tail=_n,g.unique=En,g.unzip=Rn,Wn(g),g.clone=lt,g.cloneDeep=ft,g.contains=zt,g.escape=Jn,g.every=Ft,g.find=Ht,g.findIndex=ln,g.findKey=dt,g.findLast=Vt,g.findLastIndex=fn,g.findLastKey=ht,g.has=vt,g.identity=Gn,g.indexOf=pn,g.isArguments=ct,g.isArray=Yr,g.isBoolean=bt,g.isDate=wt,g.isElement=jt,g.isEmpty=_t,g.isEqual=kt,g.isFinite=At,g.isFunction=Et,g.isNaN=Rt,g.isNull=St,g.isNumber=Pt,g.isObject=xt,g.isPlainObject=ui,g.isRegExp=Ct,g.isString=Nt,g.isUndefined=Lt,g.lastIndexOf=yn,g.mixin=Wn,g.noConflict=$n,g.parseInt=di,g.random=Kn,g.reduce=Qt,g.reduceRight=Zt,g.result=Yn,g.runInContext=h,g.size=rn,g.some=on,g.sortedIndex=kn,g.template=Xn,g.unescape=Zn,g.uniqueId=er,g.all=Ft,g.any=on,g.detect=Ht,g.findWhere=Ht,g.foldl=Qt,g.foldr=Zt,g.include=zt,g.inject=Qt,si(g,function(e,t){g.prototype[t]||(g.prototype[t]=function(){var t=[this.__wrapped__],n=this.__chain__;Rr.apply(t,arguments);var r=e.apply(g,t);return n?new m(r,n):r})}),g.first=dn,g.last=vn,g.sample=tn,g.take=dn,g.head=dn,si(g,function(e,t){var n="sample"!==t;g.prototype[t]||(g.prototype[t]=function(t,r){var i=this.__chain__,o=e(this.__wrapped__,t,r);return i||null!=t&&(!r||n&&"function"==typeof t)?new m(o,i):o})}),g.VERSION="2.2.1",g.prototype.chain=rr,g.prototype.toString=ir,g.prototype.value=or,g.prototype.valueOf=or,Jt(["join","pop","shift"],function(e){var t=mr[e];g.prototype[e]=function(){var e=this.__chain__,n=t.apply(this.__wrapped__,arguments);return e?new m(n,e):n}}),Jt(["push","reverse","sort","unshift"],function(e){var t=mr[e];g.prototype[e]=function(){return t.apply(this.__wrapped__,arguments),this}}),Jt(["concat","slice","splice"],function(e){var t=mr[e];g.prototype[e]=function(){return new m(t.apply(this.__wrapped__,arguments),this.__chain__)}}),g}var p,g=[],m=[],v=0,y=+new Date+"",b=75,w=40,j=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",_=/\b__p \+= '';/g,k=/\b(__p \+=) '' \+/g,A=/(__e\(.*?\)|\b__t\)) \+\n'';/g,E=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,x=/\w*$/,R=/^function[ \n\r\t]+\w/,S=/<%=([\s\S]+?)%>/g,P=RegExp("^["+j+"]*0+(?=.$)"),C=/($^)/,N=/\bthis\b/,L=/['\n\r\t\u2028\u2029\\]/g,B=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"],I=0,D="[object Arguments]",O="[object Array]",U="[object Boolean]",T="[object Date]",q="[object Function]",z="[object Number]",F="[object Object]",M="[object RegExp]",H="[object String]",V={};V[q]=!1,V[D]=V[O]=V[U]=V[T]=V[z]=V[F]=V[M]=V[H]=!0;var J={leading:!1,maxWait:0,trailing:!1},G={configurable:!1,enumerable:!1,value:null,writable:!1},W={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},$={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},K=W[typeof window]&&window||this,Y=W[typeof exports]&&exports&&!exports.nodeType&&exports,X=W[typeof module]&&module&&!module.nodeType&&module,Q=X&&X.exports===Y&&Y,Z=W[typeof global]&&global;!Z||Z.global!==Z&&Z.window!==Z||(K=Z);var et=h();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(K._=et,define("lodash",[],function(){return et})):Y&&X?Q?(X.exports=et)._=et:Y._=et:K._=et}).call(this),!function(e){function t(){this._events={},this._conf&&n.call(this,this._conf)}function n(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners&&(this._events.maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),this.wildcard&&(this.listenerTree={}))}function r(e){this._events={},this.newListener=!1,n.call(this,e)}function i(e,t,n,r){if(!n)return[];var o,s,u,a,c,l,f,d=[],h=t.length,p=t[r],g=t[r+1];if(r===h&&n._listeners){if("function"==typeof n._listeners)return e&&e.push(n._listeners),[n];for(o=0,s=n._listeners.length;s>o;o++)e&&e.push(n._listeners[o]);return[n]}if("*"===p||"**"===p||n[p]){if("*"===p){for(u in n)"_listeners"!==u&&n.hasOwnProperty(u)&&(d=d.concat(i(e,t,n[u],r+1)));return d}if("**"===p){f=r+1===h||r+2===h&&"*"===g,f&&n._listeners&&(d=d.concat(i(e,t,n,h)));for(u in n)"_listeners"!==u&&n.hasOwnProperty(u)&&("*"===u||"**"===u?(n[u]._listeners&&!f&&(d=d.concat(i(e,t,n[u],h))),d=d.concat(i(e,t,n[u],r))):d=u===g?d.concat(i(e,t,n[u],r+2)):d.concat(i(e,t,n[u],r)));return d}d=d.concat(i(e,t,n[p],r+1))}if(a=n["*"],a&&i(e,t,a,r+1),c=n["**"])if(h>r){c._listeners&&i(e,t,c,h);for(u in c)"_listeners"!==u&&c.hasOwnProperty(u)&&(u===g?i(e,t,c[u],r+2):u===p?i(e,t,c[u],r+1):(l={},l[u]=c[u],i(e,t,{"**":l},r+1)))}else c._listeners?i(e,t,c,h):c["*"]&&c["*"]._listeners&&i(e,t,c["*"],h);return d}function o(e,t){e="string"==typeof e?e.split(this.delimiter):e.slice();for(var n=0,r=e.length;r>n+1;n++)if("**"===e[n]&&"**"===e[n+1])return;for(var i=this.listenerTree,o=e.shift();o;){if(i[o]||(i[o]={}),i=i[o],0===e.length){if(i._listeners){if("function"==typeof i._listeners)i._listeners=[i._listeners,t];else if(s(i._listeners)&&(i._listeners.push(t),!i._listeners.warned)){var a=u;"undefined"!=typeof this._events.maxListeners&&(a=this._events.maxListeners),a>0&&i._listeners.length>a&&(i._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",i._listeners.length),console.trace())}}else i._listeners=t;return!0}o=e.shift()}return!0}var s=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},u=10;r.prototype.delimiter=".",r.prototype.setMaxListeners=function(e){this._events||t.call(this),this._events.maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e},r.prototype.event="",r.prototype.once=function(e,t){return this.many(e,1,t),this},r.prototype.many=function(e,t,n){function r(){0===--t&&i.off(e,r),n.apply(this,arguments)}var i=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");return r._origin=n,this.on(e,r),i},r.prototype.emit=function(){this._events||t.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return!1;
if(this._all){for(var n=arguments.length,r=new Array(n-1),o=1;n>o;o++)r[o-1]=arguments[o];for(o=0,n=this._all.length;n>o;o++)this.event=e,this._all[o].apply(this,r)}if("error"===e&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var s;if(this.wildcard){s=[];var u="string"==typeof e?e.split(this.delimiter):e.slice();i.call(this,s,u,this.listenerTree,0)}else s=this._events[e];if("function"==typeof s){if(this.event=e,1===arguments.length)s.call(this);else if(arguments.length>1)switch(arguments.length){case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:for(var n=arguments.length,r=new Array(n-1),o=1;n>o;o++)r[o-1]=arguments[o];s.apply(this,r)}return!0}if(s){for(var n=arguments.length,r=new Array(n-1),o=1;n>o;o++)r[o-1]=arguments[o];for(var a=s.slice(),o=0,n=a.length;n>o;o++)this.event=e,a[o].apply(this,r);return a.length>0||this._all}return this._all},r.prototype.on=function(e,n){if("function"==typeof e)return this.onAny(e),this;if("function"!=typeof n)throw new Error("on only accepts instances of Function");if(this._events||t.call(this),this.emit("newListener",e,n),this.wildcard)return o.call(this,e,n),this;if(this._events[e]){if("function"==typeof this._events[e])this._events[e]=[this._events[e],n];else if(s(this._events[e])&&(this._events[e].push(n),!this._events[e].warned)){var r=u;"undefined"!=typeof this._events.maxListeners&&(r=this._events.maxListeners),r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}}else this._events[e]=n;return this},r.prototype.onAny=function(e){if(this._all||(this._all=[]),"function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all.push(e),this},r.prototype.addListener=r.prototype.on,r.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var n,r=[];if(this.wildcard){var o="string"==typeof e?e.split(this.delimiter):e.slice();r=i.call(this,null,o,this.listenerTree,0)}else{if(!this._events[e])return this;n=this._events[e],r.push({_listeners:n})}for(var u=0;u<r.length;u++){var a=r[u];if(n=a._listeners,s(n)){for(var c=-1,l=0,f=n.length;f>l;l++)if(n[l]===t||n[l].listener&&n[l].listener===t||n[l]._origin&&n[l]._origin===t){c=l;break}if(0>c)continue;return this.wildcard?a._listeners.splice(c,1):this._events[e].splice(c,1),0===n.length&&(this.wildcard?delete a._listeners:delete this._events[e]),this}(n===t||n.listener&&n.listener===t||n._origin&&n._origin===t)&&(this.wildcard?delete a._listeners:delete this._events[e])}return this},r.prototype.offAny=function(e){var t,n=0,r=0;if(e&&this._all&&this._all.length>0){for(t=this._all,n=0,r=t.length;r>n;n++)if(e===t[n])return t.splice(n,1),this}else this._all=[];return this},r.prototype.removeListener=r.prototype.off,r.prototype.removeAllListeners=function(e){if(0===arguments.length)return!this._events||t.call(this),this;if(this.wildcard)for(var n="string"==typeof e?e.split(this.delimiter):e.slice(),r=i.call(this,null,n,this.listenerTree,0),o=0;o<r.length;o++){var s=r[o];s._listeners=null}else{if(!this._events[e])return this;this._events[e]=null}return this},r.prototype.listeners=function(e){if(this.wildcard){var n=[],r="string"==typeof e?e.split(this.delimiter):e.slice();return i.call(this,n,r,this.listenerTree,0),n}return this._events||t.call(this),this._events[e]||(this._events[e]=[]),s(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},r.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define("eventemitter2",[],function(){return r}):e.EventEmitter2=r}("undefined"!=typeof process&&"undefined"!=typeof process.title&&"undefined"!=typeof exports?exports:window),define("muskepeer-module",["lodash","eventemitter2"],function(e,t){var n,r=new t({wildcard:!0,delimiter:":",newListener:!1,maxListeners:10});return n=function(){var t=this;this.extend=function(n){return e.extend(t,n)},this.emit=r.emit,this.on=r.on,this.off=r.off}}),function(e){if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define("q",e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else Q=e()}(function(){function e(e){return function(){return K.apply(e,arguments)}}function t(e){return e===Object(e)}function n(e){return"[object StopIteration]"===rt(e)||e instanceof J}function r(e,t){if(M&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(ot)){for(var n=[],r=t;r;r=r.source)r.stack&&n.unshift(r.stack);n.unshift(e.stack);var o=n.join("\n"+ot+"\n");e.stack=i(o)}}function i(e){for(var t=e.split("\n"),n=[],r=0;r<t.length;++r){var i=t[r];u(i)||o(i)||!i||n.push(i)}return n.join("\n")}function o(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function s(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(e);return r?[r[1],Number(r[2])]:void 0}function u(e){var t=s(e);if(!t)return!1;var n=t[0],r=t[1];return n===V&&r>=G&&lt>=r}function a(){if(M)try{throw new Error}catch(e){var t=e.stack.split("\n"),n=t[0].indexOf("@")>0?t[1]:t[2],r=s(n);if(!r)return;return V=r[0],r[1]}}function c(e,t,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t+" is deprecated, use "+n+" instead.",new Error("").stack),e.apply(e,arguments)}}function l(e){return v(e)?e:y(e)?P(e):S(e)}function f(){function e(e){t=e,o.source=e,X(n,function(t,n){$(function(){e.promiseDispatch.apply(e,n)})},void 0),n=void 0,r=void 0}var t,n=[],r=[],i=et(f.prototype),o=et(p.prototype);if(o.promiseDispatch=function(e,i,o){var s=Y(arguments);n?(n.push(s),"when"===i&&o[1]&&r.push(o[1])):$(function(){t.promiseDispatch.apply(t,s)})},o.valueOf=c(function(){if(n)return o;var e=m(t);return v(e)&&(t=e),e},"valueOf","inspect"),o.inspect=function(){return t?t.inspect():{state:"pending"}},l.longStackSupport&&M)try{throw new Error}catch(s){o.stack=s.stack.substring(s.stack.indexOf("\n")+1)}return i.promise=o,i.resolve=function(n){t||e(l(n))},i.fulfill=function(n){t||e(S(n))},i.reject=function(n){t||e(R(n))},i.notify=function(e){t||X(r,function(t,n){$(function(){n(e)})},void 0)},i}function d(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=f();try{e(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}return t.promise}function h(e){return d(function(t,n){for(var r=0,i=e.length;i>r;r++)l(e[r]).then(t,n)})}function p(e,t,n){void 0===t&&(t=function(e){return R(new Error("Promise does not support operation: "+e))}),void 0===n&&(n=function(){return{state:"unknown"}});var r=et(p.prototype);if(r.promiseDispatch=function(n,i,o){var s;try{s=e[i]?e[i].apply(r,o):t.call(r,i,o)}catch(u){s=R(u)}n&&n(s)},r.inspect=n,n){var i=n();"rejected"===i.state&&(r.exception=i.reason),r.valueOf=c(function(){var e=n();return"pending"===e.state||"rejected"===e.state?r:e.value})}return r}function g(e,t,n,r){return l(e).then(t,n,r)}function m(e){if(v(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function v(e){return t(e)&&"function"==typeof e.promiseDispatch&&"function"==typeof e.inspect}function y(e){return t(e)&&"function"==typeof e.then}function b(e){return v(e)&&"pending"===e.inspect().state}function w(e){return!v(e)||"fulfilled"===e.inspect().state}function j(e){return v(e)&&"rejected"===e.inspect().state}function _(){at||"undefined"==typeof window||window.Touch||!window.console||console.warn("[Q] Unhandled rejection reasons (should be empty):",st),at=!0}function k(){for(var e=0;e<st.length;e++){var t=st[e];console.warn("Unhandled rejection reason:",t)}}function A(){st.length=0,ut.length=0,at=!1,ct||(ct=!0,"undefined"!=typeof process&&process.on&&process.on("exit",k))}function E(e,t){ct&&(ut.push(e),t&&"undefined"!=typeof t.stack?st.push(t.stack):st.push("(no stack) "+t),_())}function x(e){if(ct){var t=Q(ut,e);-1!==t&&(ut.splice(t,1),st.splice(t,1))}}function R(e){var t=p({when:function(t){return t&&x(this),t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return E(t,e),t}function S(e){return p({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},"delete":function(t){delete e[t]},post:function(t,n){return null===t||void 0===t?e.apply(void 0,n):e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},keys:function(){return nt(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function P(e){var t=f();return $(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}}),t.promise}function C(e){return p({isDef:function(){}},function(t,n){return O(e,t,n)},function(){return l(e).inspect()})}function N(e,t,n){return l(e).spread(t,n)}function L(e){return function(){function t(e,t){var s;if(it){try{s=r[e](t)}catch(u){return R(u)}return s.done?s.value:g(s.value,i,o)}try{s=r[e](t)}catch(u){return n(u)?u.value:R(u)}return g(s,i,o)}var r=e.apply(this,arguments),i=t.bind(t,"next"),o=t.bind(t,"throw");return i()}}function B(e){l.done(l.async(e)())}function I(e){throw new J(e)}function D(e){return function(){return N([this,U(arguments)],function(t,n){return e.apply(t,n)})}}function O(e,t,n){return l(e).dispatch(t,n)}function U(e){return g(e,function(e){var t=0,n=f();return X(e,function(r,i,o){var s;v(i)&&"fulfilled"===(s=i.inspect()).state?e[o]=s.value:(++t,g(i,function(r){e[o]=r,0===--t&&n.resolve(e)},n.reject,function(e){n.notify({index:o,value:e})}))},void 0),0===t&&n.resolve(e),n.promise})}function T(e){return g(e,function(e){return e=Z(e,l),g(U(Z(e,function(e){return g(e,W,W)})),function(){return e})})}function q(e){return l(e).allSettled()}function z(e,t){return l(e).then(void 0,void 0,t)}function F(e,t){return l(e).nodeify(t)}var M=!1;try{throw new Error}catch(H){M=!!H.stack}var V,J,G=a(),W=function(){},$=function(){function e(){for(;t.next;){t=t.next;var n=t.task;t.task=void 0;var i=t.domain;i&&(t.domain=void 0,i.enter());try{n()}catch(s){if(o)throw i&&i.exit(),setTimeout(e,0),i&&i.enter(),s;setTimeout(function(){throw s},0)}i&&i.exit()}r=!1}var t={task:void 0,next:null},n=t,r=!1,i=void 0,o=!1;if($=function(e){n=n.next={task:e,domain:o&&process.domain,next:null},r||(r=!0,i())},"undefined"!=typeof process&&process.nextTick)o=!0,i=function(){process.nextTick(e)};else if("function"==typeof setImmediate)i="undefined"!=typeof window?setImmediate.bind(window,e):function(){setImmediate(e)};else if("undefined"!=typeof MessageChannel){var s=new MessageChannel;s.port1.onmessage=function(){i=u,s.port1.onmessage=e,e()};var u=function(){s.port2.postMessage(0)};i=function(){setTimeout(e,0),u()}}else i=function(){setTimeout(e,0)};return $}(),K=Function.call,Y=e(Array.prototype.slice),X=e(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(1===arguments.length)for(;;){if(n in this){t=this[n++];break}if(++n>=r)throw new TypeError}for(;r>n;n++)n in this&&(t=e(t,this[n],n));return t}),Q=e(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),Z=e(Array.prototype.map||function(e,t){var n=this,r=[];return X(n,function(i,o,s){r.push(e.call(t,o,s,n))},void 0),r}),et=Object.create||function(e){function t(){}return t.prototype=e,new t},tt=e(Object.prototype.hasOwnProperty),nt=Object.keys||function(e){var t=[];for(var n in e)tt(e,n)&&t.push(n);return t},rt=e(Object.prototype.toString);J="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var it;try{new Function("(function* (){ yield 1; })"),it=!0}catch(H){it=!1}var ot="From previous event:";l.resolve=l,l.nextTick=$,l.longStackSupport=!1,l.defer=f,f.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(Y(arguments,1)):e.resolve(n)}},l.promise=d,l.passByCopy=function(e){return e},p.prototype.passByCopy=function(){return this},l.join=function(e,t){return l(e).join(t)},p.prototype.join=function(e){return l([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Can't join: not the same: "+e+" "+t)})},l.race=h,p.prototype.race=function(){return this.then(l.race)},l.makePromise=p,p.prototype.toString=function(){return"[object Promise]"},p.prototype.then=function(e,t,n){function i(t){try{return"function"==typeof e?e(t):t}catch(n){return R(n)}}function o(e){if("function"==typeof t){r(e,u);try{return t(e)}catch(n){return R(n)}}return R(e)}function s(e){return"function"==typeof n?n(e):e}var u=this,a=f(),c=!1;return $(function(){u.promiseDispatch(function(e){c||(c=!0,a.resolve(i(e)))},"when",[function(e){c||(c=!0,a.resolve(o(e)))}])}),u.promiseDispatch(void 0,"when",[void 0,function(e){var t,n=!1;try{t=s(e)}catch(r){if(n=!0,!l.onerror)throw r;l.onerror(r)}n||a.notify(t)}]),a.promise},l.when=g,p.prototype.thenResolve=function(e){return this.then(function(){return e})},l.thenResolve=function(e,t){return l(e).thenResolve(t)},p.prototype.thenReject=function(e){return this.then(function(){throw e})},l.thenReject=function(e,t){return l(e).thenReject(t)},l.nearer=m,l.isPromise=v,l.isPromiseAlike=y,l.isPending=b,p.prototype.isPending=function(){return"pending"===this.inspect().state},l.isFulfilled=w,p.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},l.isRejected=j,p.prototype.isRejected=function(){return"rejected"===this.inspect().state};var st=[],ut=[],at=!1,ct=!0;l.resetUnhandledRejections=A,l.getUnhandledReasons=function(){return st.slice()},l.stopUnhandledRejectionTracking=function(){A(),"undefined"!=typeof process&&process.on&&process.removeListener("exit",k),ct=!1},A(),l.reject=R,l.fulfill=S,l.master=C,l.spread=N,p.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},l.async=L,l.spawn=B,l["return"]=I,l.promised=D,l.dispatch=O,p.prototype.dispatch=function(e,t){var n=this,r=f();return $(function(){n.promiseDispatch(r.resolve,e,t)}),r.promise},l.get=function(e,t){return l(e).dispatch("get",[t])},p.prototype.get=function(e){return this.dispatch("get",[e])},l.set=function(e,t,n){return l(e).dispatch("set",[t,n])},p.prototype.set=function(e,t){return this.dispatch("set",[e,t])},l.del=l["delete"]=function(e,t){return l(e).dispatch("delete",[t])},p.prototype.del=p.prototype["delete"]=function(e){return this.dispatch("delete",[e])},l.mapply=l.post=function(e,t,n){return l(e).dispatch("post",[t,n])},p.prototype.mapply=p.prototype.post=function(e,t){return this.dispatch("post",[e,t])},l.send=l.mcall=l.invoke=function(e,t){return l(e).dispatch("post",[t,Y(arguments,2)])},p.prototype.send=p.prototype.mcall=p.prototype.invoke=function(e){return this.dispatch("post",[e,Y(arguments,1)])},l.fapply=function(e,t){return l(e).dispatch("apply",[void 0,t])},p.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},l["try"]=l.fcall=function(e){return l(e).dispatch("apply",[void 0,Y(arguments,1)])},p.prototype.fcall=function(){return this.dispatch("apply",[void 0,Y(arguments)])},l.fbind=function(e){var t=l(e),n=Y(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(Y(arguments))])}},p.prototype.fbind=function(){var e=this,t=Y(arguments);return function(){return e.dispatch("apply",[this,t.concat(Y(arguments))])}},l.keys=function(e){return l(e).dispatch("keys",[])},p.prototype.keys=function(){return this.dispatch("keys",[])},l.all=U,p.prototype.all=function(){return U(this)},l.allResolved=c(T,"allResolved","allSettled"),p.prototype.allResolved=function(){return T(this)},l.allSettled=q,p.prototype.allSettled=function(){return this.then(function(e){return U(Z(e,function(e){function t(){return e.inspect()}return e=l(e),e.then(t,t)}))})},l.fail=l["catch"]=function(e,t){return l(e).then(void 0,t)},p.prototype.fail=p.prototype["catch"]=function(e){return this.then(void 0,e)},l.progress=z,p.prototype.progress=function(e){return this.then(void 0,void 0,e)},l.fin=l["finally"]=function(e,t){return l(e)["finally"](t)},p.prototype.fin=p.prototype["finally"]=function(e){return e=l(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},l.done=function(e,t,n,r){return l(e).done(t,n,r)},p.prototype.done=function(e,t,n){var i=function(e){$(function(){if(r(e,o),!l.onerror)throw e;l.onerror(e)})},o=e||t||n?this.then(e,t,n):this;"object"==typeof process&&process&&process.domain&&(i=process.domain.bind(i)),o.then(void 0,i)},l.timeout=function(e,t,n){return l(e).timeout(t,n)},p.prototype.timeout=function(e,t){var n=f(),r=setTimeout(function(){n.reject(new Error(t||"Timed out after "+e+" ms"))},e);return this.then(function(e){clearTimeout(r),n.resolve(e)},function(e){clearTimeout(r),n.reject(e)},n.notify),n.promise},l.delay=function(e,t){return void 0===t&&(t=e,e=void 0),l(e).delay(t)},p.prototype.delay=function(e){return this.then(function(t){var n=f();return setTimeout(function(){n.resolve(t)},e),n.promise})},l.nfapply=function(e,t){return l(e).nfapply(t)},p.prototype.nfapply=function(e){var t=f(),n=Y(e);return n.push(t.makeNodeResolver()),this.fapply(n).fail(t.reject),t.promise},l.nfcall=function(e){var t=Y(arguments,1);return l(e).nfapply(t)},p.prototype.nfcall=function(){var e=Y(arguments),t=f();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},l.nfbind=l.denodeify=function(e){var t=Y(arguments,1);return function(){var n=t.concat(Y(arguments)),r=f();return n.push(r.makeNodeResolver()),l(e).fapply(n).fail(r.reject),r.promise}},p.prototype.nfbind=p.prototype.denodeify=function(){var e=Y(arguments);return e.unshift(this),l.denodeify.apply(void 0,e)},l.nbind=function(e,t){var n=Y(arguments,2);return function(){function r(){return e.apply(t,arguments)}var i=n.concat(Y(arguments)),o=f();return i.push(o.makeNodeResolver()),l(r).fapply(i).fail(o.reject),o.promise}},p.prototype.nbind=function(){var e=Y(arguments,0);return e.unshift(this),l.nbind.apply(void 0,e)},l.nmapply=l.npost=function(e,t,n){return l(e).npost(t,n)},p.prototype.nmapply=p.prototype.npost=function(e,t){var n=Y(t||[]),r=f();return n.push(r.makeNodeResolver()),this.dispatch("post",[e,n]).fail(r.reject),r.promise},l.nsend=l.nmcall=l.ninvoke=function(e,t){var n=Y(arguments,2),r=f();return n.push(r.makeNodeResolver()),l(e).dispatch("post",[t,n]).fail(r.reject),r.promise},p.prototype.nsend=p.prototype.nmcall=p.prototype.ninvoke=function(e){var t=Y(arguments,1),n=f();return t.push(n.makeNodeResolver()),this.dispatch("post",[e,t]).fail(n.reject),n.promise},l.nodeify=F,p.prototype.nodeify=function(e){return e?(this.then(function(t){$(function(){e(null,t)})},function(t){$(function(){e(t)})}),void 0):this};var lt=a();return l}),function(){function e(e,t,n){var r=t&&n||0,i=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){16>i&&(t[r+i++]=d[e])});16>i;)t[r+i++]=0;return t}function t(e,t){var n=t||0,r=f;return r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]}function n(e,n,r){var i=n&&r||0,o=n||[];e=e||{};var s=null!=e.clockseq?e.clockseq:m,u=null!=e.msecs?e.msecs:(new Date).getTime(),a=null!=e.nsecs?e.nsecs:y+1,c=u-v+(a-y)/1e4;if(0>c&&null==e.clockseq&&(s=16383&s+1),(0>c||u>v)&&null==e.nsecs&&(a=0),a>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");v=u,y=a,m=s,u+=122192928e5;var l=(1e4*(268435455&u)+a)%4294967296;o[i++]=255&l>>>24,o[i++]=255&l>>>16,o[i++]=255&l>>>8,o[i++]=255&l;var f=268435455&1e4*(u/4294967296);o[i++]=255&f>>>8,o[i++]=255&f,o[i++]=16|15&f>>>24,o[i++]=255&f>>>16,o[i++]=128|s>>>8,o[i++]=255&s;for(var d=e.node||g,h=0;6>h;h++)o[i+h]=d[h];return n?n:t(o)}function r(e,n,r){var o=n&&r||0;"string"==typeof e&&(n="binary"==e?new l(16):null,e=null),e=e||{};var s=e.random||(e.rng||i)();if(s[6]=64|15&s[6],s[8]=128|63&s[8],n)for(var u=0;16>u;u++)n[o+u]=s[u];return n||t(s)}var i,o=this;if("function"==typeof require)try{var s=require("crypto").randomBytes;i=s&&function(){return s(16)}}catch(u){}if(!i&&o.crypto&&crypto.getRandomValues){var a=new Uint8Array(16);i=function(){return crypto.getRandomValues(a),a}}if(!i){var c=new Array(16);i=function(){for(var e,t=0;16>t;t++)0===(3&t)&&(e=4294967296*Math.random()),c[t]=255&e>>>((3&t)<<3);return c}}for(var l="function"==typeof Buffer?Buffer:Array,f=[],d={},h=0;256>h;h++)f[h]=(h+256).toString(16).substr(1),d[f[h]]=h;var p=i(),g=[1|p[0],p[1],p[2],p[3],p[4],p[5]],m=16383&(p[6]<<8|p[7]),v=0,y=0,b=r;if(b.v1=n,b.v4=r,b.parse=e,b.unparse=t,b.BufferClass=l,"function"==typeof define&&define.amd)define("node-uuid",[],function(){return b});else if("undefined"!=typeof module&&module.exports)module.exports=b;else{var w=o.uuid;b.noConflict=function(){return o.uuid=w,b},o.uuid=b}}.call(this),define("uuid",["node-uuid"],function(e){var t=new RegExp(/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i);return{generate:function(){return e.v4()},isValid:function(e){return t.test(e)}}}),define("project",[],function(){return{files:["https://dl.dropboxusercontent.com/u/959008/webstorm.pdf","https://dl.dropboxusercontent.com/u/959008/paris.jpg","https://dl.dropboxusercontent.com/u/959008/download.pdf","https://dl.dropboxusercontent.com/u/959008/p2p.pdf"],computation:{jobs:{autoGeneration:!0,createJobParameters:function(e){var t=0|10*Math.random(),n=0|10*Math.random();return console.log(e),{a:t,b:n}},list:"http://www.google.de",groupSize:100},worker:{algorithm:function(){window.URL=window.URL;var e,t="self.onmessage=function(e){postMessage('Worker: '+e.data);}";try{e=new Blob([t])}catch(n){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,e=new BlobBuilder,e.append(t),e=e.getBlob()}return e}}}}}),function(e,t,n){"function"==typeof define?define("idbwrapper",t):"undefined"!=typeof module&&module.exports?module.exports=t():n[e]=t()}("IDBStore",function(){var e=function(e){throw e},t={storeName:"Store",storePrefix:"IDBWrapper-",dbVersion:1,keyPath:"id",autoIncrement:!0,onStoreReady:function(){},onError:e,indexes:[]},n=function(e,n){"undefined"==typeof n&&"function"==typeof e&&(n=e),"[object Object]"!=Object.prototype.toString.call(e)&&(e={});for(var r in t)this[r]="undefined"!=typeof e[r]?e[r]:t[r];this.dbName=this.storePrefix+this.storeName,this.dbVersion=parseInt(this.dbVersion,10)||1,n&&(this.onStoreReady=n);var i="object"==typeof window?window:self;this.idb=i.indexedDB||i.webkitIndexedDB||i.mozIndexedDB,this.keyRange=i.IDBKeyRange||i.webkitIDBKeyRange||i.mozIDBKeyRange,this.features={hasAutoIncrement:!i.mozIndexedDB},this.consts={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange",NEXT:"next",NEXT_NO_DUPLICATE:"nextunique",PREV:"prev",PREV_NO_DUPLICATE:"prevunique"},this.openDB()};n.prototype={constructor:n,version:"1.4.1",db:null,dbName:null,dbVersion:null,store:null,storeName:null,keyPath:null,autoIncrement:null,indexes:null,features:null,onStoreReady:null,onError:null,_insertIdCount:0,openDB:function(){var e=this.idb.open(this.dbName,this.dbVersion),t=!1;e.onerror=function(e){var t=!1;"error"in e.target?t="VersionError"==e.target.error.name:"errorCode"in e.target&&(t=12==e.target.errorCode),t?this.onError(new Error("The version number provided is lower than the existing one.")):this.onError(e)}.bind(this),e.onsuccess=function(e){if(!t){if(this.db)return this.onStoreReady(),void 0;if(this.db=e.target.result,"string"==typeof this.db.version)return this.onError(new Error("The IndexedDB implementation in this browser is outdated. Please upgrade your browser.")),void 0;if(!this.db.objectStoreNames.contains(this.storeName))return this.onError(new Error("Something is wrong with the IndexedDB implementation in this browser. Please upgrade your browser.")),void 0;var n=this.db.transaction([this.storeName],this.consts.READ_ONLY);this.store=n.objectStore(this.storeName);var r=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(e){var n=e.name;if(!n)return t=!0,this.onError(new Error("Cannot create index: No index name given.")),void 0;if(this.normalizeIndexData(e),this.hasIndex(n)){var i=this.store.index(n),o=this.indexComplies(i,e);o||(t=!0,this.onError(new Error('Cannot modify index "'+n+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),r.splice(r.indexOf(n),1)}else t=!0,this.onError(new Error('Cannot create new index "'+n+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))},this),r.length&&(t=!0,this.onError(new Error('Cannot delete index(es) "'+r.toString()+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),t||this.onStoreReady()}}.bind(this),e.onupgradeneeded=function(e){if(this.db=e.target.result,this.db.objectStoreNames.contains(this.storeName))this.store=e.target.transaction.objectStore(this.storeName);else{var n={autoIncrement:this.autoIncrement};null!==this.keyPath&&(n.keyPath=this.keyPath),this.store=this.db.createObjectStore(this.storeName,n)}var r=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(e){var n=e.name;if(n||(t=!0,this.onError(new Error("Cannot create index: No index name given."))),this.normalizeIndexData(e),this.hasIndex(n)){var i=this.store.index(n),o=this.indexComplies(i,e);o||(this.store.deleteIndex(n),this.store.createIndex(n,e.keyPath,{unique:e.unique,multiEntry:e.multiEntry})),r.splice(r.indexOf(n),1)}else this.store.createIndex(n,e.keyPath,{unique:e.unique,multiEntry:e.multiEntry})},this),r.length&&r.forEach(function(e){this.store.deleteIndex(e)},this)}.bind(this)},deleteDatabase:function(){this.idb.deleteDatabase&&this.idb.deleteDatabase(this.dbName)},put:function(t,n,i,o){null!==this.keyPath&&(o=i,i=n,n=t),o||(o=e),i||(i=r);var s,u=!1,a=null,c=this.db.transaction([this.storeName],this.consts.READ_WRITE);return c.oncomplete=function(){var e=u?i:o;e(a)},c.onabort=o,c.onerror=o,null!==this.keyPath?(this._addIdPropertyIfNeeded(n),s=c.objectStore(this.storeName).put(n)):s=c.objectStore(this.storeName).put(n,t),s.onsuccess=function(e){u=!0,a=e.target.result},s.onerror=o,c},get:function(t,n,i){i||(i=e),n||(n=r);var o=!1,s=null,u=this.db.transaction([this.storeName],this.consts.READ_ONLY);u.oncomplete=function(){var e=o?n:i;e(s)},u.onabort=i,u.onerror=i;var a=u.objectStore(this.storeName).get(t);return a.onsuccess=function(e){o=!0,s=e.target.result},a.onerror=i,u},remove:function(t,n,i){i||(i=e),n||(n=r);var o=!1,s=null,u=this.db.transaction([this.storeName],this.consts.READ_WRITE);u.oncomplete=function(){var e=o?n:i;e(s)},u.onabort=i,u.onerror=i;var a=u.objectStore(this.storeName)["delete"](t);return a.onsuccess=function(e){o=!0,s=e.target.result},a.onerror=i,u},batch:function(t,n,i){i||(i=e),n||(n=r),"[object Array]"!=Object.prototype.toString.call(t)&&i(new Error("dataArray argument must be of type Array."));var o=this.db.transaction([this.storeName],this.consts.READ_WRITE);o.oncomplete=function(){var e=a?n:i;e(a)},o.onabort=i,o.onerror=i;var s=t.length,u=!1,a=!1,c=function(){s--,0!==s||u||(u=!0,a=!0)};return t.forEach(function(e){var t=e.type,n=e.key,r=e.value,s=function(e){o.abort(),u||(u=!0,i(e,t,n))};if("remove"==t){var a=o.objectStore(this.storeName)["delete"](n);a.onsuccess=c,a.onerror=s}else if("put"==t){var l;null!==this.keyPath?(this._addIdPropertyIfNeeded(r),l=o.objectStore(this.storeName).put(r)):l=o.objectStore(this.storeName).put(r,n),l.onsuccess=c,l.onerror=s}},this),o},putBatch:function(e,t,n){var r=e.map(function(e){return{type:"put",value:e}});return this.batch(r,t,n)},removeBatch:function(e,t,n){var r=e.map(function(e){return{type:"remove",key:e}});return this.batch(r,t,n)},getBatch:function(t,n,i,o){i||(i=e),n||(n=r),o||(o="sparse"),"[object Array]"!=Object.prototype.toString.call(t)&&i(new Error("keyArray argument must be of type Array."));var s=this.db.transaction([this.storeName],this.consts.READ_ONLY);s.oncomplete=function(){var e=l?n:i;e(f)},s.onabort=i,s.onerror=i;var u=[],a=t.length,c=!1,l=!1,f=null,d=function(e){e.target.result||"dense"==o?u.push(e.target.result):"sparse"==o&&u.length++,a--,0===a&&(c=!0,l=!0,f=u)};return t.forEach(function(e){var t=function(e){c=!0,f=e,i(e),s.abort()},n=s.objectStore(this.storeName).get(e);n.onsuccess=d,n.onerror=t},this),s},getAll:function(t,n){n||(n=e),t||(t=r);var i=this.db.transaction([this.storeName],this.consts.READ_ONLY),o=i.objectStore(this.storeName);return o.getAll?this._getAllNative(i,o,t,n):this._getAllCursor(i,o,t,n),i},_getAllNative:function(e,t,n,r){var i=!1,o=null;e.oncomplete=function(){var e=i?n:r;e(o)},e.onabort=r,e.onerror=r;var s=t.getAll();s.onsuccess=function(e){i=!0,o=e.target.result},s.onerror=r},_getAllCursor:function(e,t,n,r){var i=[],o=!1,s=null;e.oncomplete=function(){var e=o?n:r;e(s)},e.onabort=r,e.onerror=r;var u=t.openCursor();u.onsuccess=function(e){var t=e.target.result;t?(i.push(t.value),t["continue"]()):(o=!0,s=i)},u.onError=r},clear:function(t,n){n||(n=e),t||(t=r);var i=!1,o=null,s=this.db.transaction([this.storeName],this.consts.READ_WRITE);s.oncomplete=function(){var e=i?t:n;e(o)},s.onabort=n,s.onerror=n;var u=s.objectStore(this.storeName).clear();return u.onsuccess=function(e){i=!0,o=e.target.result},u.onerror=n,s},_addIdPropertyIfNeeded:function(e){this.features.hasAutoIncrement||"undefined"!=typeof e[this.keyPath]||(e[this.keyPath]=this._insertIdCount++ +Date.now())},getIndexList:function(){return this.store.indexNames},hasIndex:function(e){return this.store.indexNames.contains(e)},normalizeIndexData:function(e){e.keyPath=e.keyPath||e.name,e.unique=!!e.unique,e.multiEntry=!!e.multiEntry},indexComplies:function(e,t){var n=["keyPath","unique","multiEntry"].every(function(n){if("multiEntry"==n&&void 0===e[n]&&t[n]===!1)return!0;if("keyPath"==n&&"[object Array]"==Object.prototype.toString.call(t[n])){var r=t.keyPath,i=e.keyPath;if("string"==typeof i)return r.toString()==i;if("function"!=typeof i.contains&&"function"!=typeof i.indexOf)return!1;if(i.length!==r.length)return!1;for(var o=0,s=r.length;s>o;o++)if(!(i.contains&&i.contains(r[o])||i.indexOf(-1!==r[o])))return!1;return!0}return t[n]==e[n]});return n},iterate:function(t,n){n=o({index:null,order:"ASC",autoContinue:!0,filterDuplicates:!1,keyRange:null,writeAccess:!1,onEnd:null,onError:e},n||{});var r="desc"==n.order.toLowerCase()?"PREV":"NEXT";n.filterDuplicates&&(r+="_NO_DUPLICATE");var i=!1,s=this.db.transaction([this.storeName],this.consts[n.writeAccess?"READ_WRITE":"READ_ONLY"]),u=s.objectStore(this.storeName);n.index&&(u=u.index(n.index)),s.oncomplete=function(){return i?(n.onEnd?n.onEnd():t(null),void 0):(n.onError(null),void 0)},s.onabort=n.onError,s.onerror=n.onError;var a=u.openCursor(n.keyRange,this.consts[r]);return a.onerror=n.onError,a.onsuccess=function(e){var r=e.target.result;r?(t(r.value,r,s),n.autoContinue&&r["continue"]()):i=!0},s},query:function(e,t){var n=[];return t=t||{},t.onEnd=function(){e(n)},this.iterate(function(e){n.push(e)},t)},count:function(t,n){n=o({index:null,keyRange:null},n||{});var r=n.onError||e,i=!1,s=null,u=this.db.transaction([this.storeName],this.consts.READ_ONLY);u.oncomplete=function(){var e=i?t:r;e(s)},u.onabort=r,u.onerror=r;var a=u.objectStore(this.storeName);n.index&&(a=a.index(n.index));var c=a.count(n.keyRange);return c.onsuccess=function(e){i=!0,s=e.target.result},c.onError=r,u},makeKeyRange:function(e){var t,n="undefined"!=typeof e.lower,r="undefined"!=typeof e.upper,i="undefined"!=typeof e.only;switch(!0){case i:t=this.keyRange.only(e.only);break;case n&&r:t=this.keyRange.bound(e.lower,e.upper,e.excludeLower,e.excludeUpper);break;case n:t=this.keyRange.lowerBound(e.lower,e.excludeLower);break;case r:t=this.keyRange.upperBound(e.upper,e.excludeUpper);break;default:throw new Error('Cannot create KeyRange. Provide one or both of "lower" or "upper" value, or an "only" value.')
}return t}};var r=function(){},i={},o=function(e,t){var n,r;for(n in t)r=t[n],r!==i[n]&&r!==e[n]&&(e[n]=r);return e};return n.version=n.prototype.version,n},this),define("storage/database",["lodash","q","uuid","project","idbwrapper"],function(e,t,n,r,i){function o(){var e,n=["results","jobs","files","nodes"],r=[];return n.forEach(function(n){e=t.defer(),l.push(new i({autoIncrement:!1,keyPath:"uuid",storeName:n,storePrefix:a,indexes:[{name:"project",keyPath:"projectUuid",unique:!1,multiEntry:!0}],onStoreReady:e.resolve,onError:e.reject})),r.push(e.promise)}),t.all(r)}function s(t){return e.find(l,function(e){return e.storeName===t})}var u,a="Muskepeer-",c={DATA_MISSING:"Data is missing!",DATA_EMPTY:"Data is empty!",DATA_NOT_OBJECT:"Data is not an object!",UUID_MISSING:"Data uuid is missing!",UUID_INVALID:"Data uuid is invalid!",STORE_NOT_FOUND:"Store not found!"},l=[];return{init:function(){return u=this,o()},clear:function(){var e,n=[];return l.forEach(function(r){e=t.defer(),r.clear(function(){e.resolve()}),n.push(e.promise)}),t.all(n)},read:function(e,r,i){var o=t.defer(),u=s(e);return i=i||{},u?i.uuidIsHash||n.isValid(r)?(u.get(r,o.resolve,o.reject),o.promise):(o.reject(c.UUID_INVALID),o.promise):(o.reject(c.STORE_NOT_FOUND),o.promise)},list:function(n,r,i,o){var u=t.defer(),a=s(n),c=[],l={index:"project",order:"ASC",filterDuplicates:!1,writeAccess:!1,onEnd:function(){u.resolve(c)},onError:function(e){u.reject(e)}};return r=r||{},r&&r.onEnd&&(r.onEnd=void 0),r&&r.onError&&(r.onError=void 0),r=e.defaults(r,l),i&&(r.keyRange=a.makeKeyRange(i)),a.iterate(function(e){if(o)for(var t in o){if(!e.hasOwnProperty(t))return;if(e[t]!==o[t])return}u.notify(e),c.push(e)},r),u.promise},findAndReduceByKeyRange:function(e,t,n){return this.list(e,t,n)},findAndReduceByObject:function(e,t,n){return this.list(e,t,null,n)},save:function(i,o,a){var l,f=t.defer();if(!e.isObject(o))return f.reject(c.DATA_NOT_OBJECT),f.promise;if(e.isEmpty(o))return f.reject(c.DATA_EMPTY),f.promise;if(a.uuidIsHash||o.uuid&&n.isValid(o.uuid)||(o.uuid=n.generate()),o.projectUuid=r.uuid,l=s(i),!l)return f.reject(c.STORE_NOT_FOUND),f.promise;if(a.allowDuplicates)l.put(o,f.resolve,f.reject);else{var d={};for(var h in o)"uuid"!==h&&o.hasOwnProperty(h)&&(d[h]=o[h]);u.findAndReduceByObject(i,null,d).then(function(t){e.isEmpty(t)?l.put(o,f.resolve,function(e){f.reject(e)}):f.resolve()})}return f.promise},saveMultiple:function(e,n,r){var i=[];return n.forEach(function(t){i.push(u.save(e,t,r))}),t.all(i)},remove:function(e,n){var r=t.defer(),i=s(e);return i||r.reject(c.STORE_NOT_FOUND),i.remove(n,r.resolve,r.reject),r.promise},update:function(r,i,o){var a=s(r),l=t.defer();return o=o||{},a?e.isEmpty(i)?(l.reject(c.DATA_EMPTY),l.promise):i.uuid?o.uuidIsHash||n.isValid(i.uuid)?(this.read(r,i.uuid,o).then(function(t){i=e.extend(t,i),a.put(i)}).then(function(){u.save(r,i,o)}).done(function(){l.resolve(i)}),l.promise):(l.reject(c.UUID_INVALID),l.promise):(l.reject(c.UUID_MISSING),l.promise):(l.reject(c.STORE_NOT_FOUND),l.promise)}}});var t=void 0,u=!1,sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(e){this.toString=function(){return"CORRUPT: "+this.message},this.message=e},invalid:function(e){this.toString=function(){return"INVALID: "+this.message},this.message=e},bug:function(e){this.toString=function(){return"BUG: "+this.message},this.message=e},notReady:function(e){this.toString=function(){return"NOT READY: "+this.message},this.message=e}}};"undefined"!=typeof module&&module.exports&&(module.exports=sjcl),sjcl.cipher.aes=function(e){this.k[0][0][0]||this.D();var t,n,r,i,o=this.k[0][4],s=this.k[1];t=e.length;var u=1;for(4!==t&&6!==t&&8!==t&&q(new sjcl.exception.invalid("invalid aes key size")),this.b=[r=e.slice(0),i=[]],e=t;4*t+28>e;e++)n=r[e-1],(0===e%t||8===t&&4===e%t)&&(n=o[n>>>24]<<24^o[255&n>>16]<<16^o[255&n>>8]<<8^o[255&n],0===e%t&&(n=n<<8^n>>>24^u<<24,u=u<<1^283*(u>>7))),r[e]=r[e-t]^n;for(t=0;e;t++,e--)n=r[3&t?e:e-4],i[t]=4>=e||4>t?n:s[0][o[n>>>24]]^s[1][o[255&n>>16]]^s[2][o[255&n>>8]]^s[3][o[255&n]]},sjcl.cipher.aes.prototype={encrypt:function(e){return y(this,e,0)},decrypt:function(e){return y(this,e,1)},k:[[[],[],[],[],[]],[[],[],[],[],[]]],D:function(){var e,t,n,r,i,o,s,u=this.k[0],a=this.k[1],c=u[4],l=a[4],f=[],d=[];for(e=0;256>e;e++)d[(f[e]=e<<1^283*(e>>7))^e]=e;for(t=n=0;!c[t];t^=r||1,n=d[n]||1)for(o=n^n<<1^n<<2^n<<3^n<<4,o=99^(o>>8^255&o),c[t]=o,l[o]=t,i=f[e=f[r=f[t]]],s=16843009*i^65537*e^257*r^16843008*t,i=257*f[o]^16843008*o,e=0;4>e;e++)u[e][t]=i=i<<24^i>>>8,a[e][o]=s=s<<24^s>>>8;for(e=0;5>e;e++)u[e]=u[e].slice(0),a[e]=a[e].slice(0)}},sjcl.bitArray={bitSlice:function(e,n,r){return e=sjcl.bitArray.P(e.slice(n/32),32-(31&n)).slice(1),r===t?e:sjcl.bitArray.clamp(e,r-n)},extract:function(e,t,n){var r=Math.floor(31&-t-n);return(-32&(t+n-1^t)?e[0|t/32]<<32-r^e[0|t/32+1]>>>r:e[0|t/32]>>>r)&(1<<n)-1},concat:function(e,t){if(0===e.length||0===t.length)return e.concat(t);var n=e[e.length-1],r=sjcl.bitArray.getPartial(n);return 32===r?e.concat(t):sjcl.bitArray.P(t,r,0|n,e.slice(0,e.length-1))},bitLength:function(e){var t=e.length;return 0===t?0:32*(t-1)+sjcl.bitArray.getPartial(e[t-1])},clamp:function(e,t){if(32*e.length<t)return e;e=e.slice(0,Math.ceil(t/32));var n=e.length;return t&=31,n>0&&t&&(e[n-1]=sjcl.bitArray.partial(t,e[n-1]&2147483648>>t-1,1)),e},partial:function(e,t,n){return 32===e?t:(n?0|t:t<<32-e)+1099511627776*e},getPartial:function(e){return Math.round(e/1099511627776)||32},equal:function(e,t){if(sjcl.bitArray.bitLength(e)!==sjcl.bitArray.bitLength(t))return u;var n,r=0;for(n=0;n<e.length;n++)r|=e[n]^t[n];return 0===r},P:function(e,n,r,i){var o;for(o=0,i===t&&(i=[]);n>=32;n-=32)i.push(r),r=0;if(0===n)return i.concat(e);for(o=0;o<e.length;o++)i.push(r|e[o]>>>n),r=e[o]<<32-n;return o=e.length?e[e.length-1]:0,e=sjcl.bitArray.getPartial(o),i.push(sjcl.bitArray.partial(31&n+e,n+e>32?r:i.pop(),1)),i},l:function(e,t){return[e[0]^t[0],e[1]^t[1],e[2]^t[2],e[3]^t[3]]}},sjcl.codec.utf8String={fromBits:function(e){var t,n,r="",i=sjcl.bitArray.bitLength(e);for(t=0;i/8>t;t++)0===(3&t)&&(n=e[t/4]),r+=String.fromCharCode(n>>>24),n<<=8;return decodeURIComponent(escape(r))},toBits:function(e){e=unescape(encodeURIComponent(e));var t,n=[],r=0;for(t=0;t<e.length;t++)r=r<<8|e.charCodeAt(t),3===(3&t)&&(n.push(r),r=0);return 3&t&&n.push(sjcl.bitArray.partial(8*(3&t),r)),n}},sjcl.codec.hex={fromBits:function(e){var t,n="";for(t=0;t<e.length;t++)n+=((0|e[t])+0xf00000000000).toString(16).substr(4);return n.substr(0,sjcl.bitArray.bitLength(e)/4)},toBits:function(e){var t,n,r=[];for(e=e.replace(/\s|0x/g,""),n=e.length,e+="00000000",t=0;t<e.length;t+=8)r.push(0^parseInt(e.substr(t,8),16));return sjcl.bitArray.clamp(r,4*n)}},sjcl.codec.base64={J:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(e,t,n){var r="",i=0,o=sjcl.codec.base64.J,s=0,u=sjcl.bitArray.bitLength(e);for(n&&(o=o.substr(0,62)+"-_"),n=0;6*r.length<u;)r+=o.charAt((s^e[n]>>>i)>>>26),6>i?(s=e[n]<<6-i,i+=26,n++):(s<<=6,i-=6);for(;3&r.length&&!t;)r+="=";return r},toBits:function(e,t){e=e.replace(/\s|=/g,"");var n,r,i=[],o=0,s=sjcl.codec.base64.J,u=0;for(t&&(s=s.substr(0,62)+"-_"),n=0;n<e.length;n++)r=s.indexOf(e.charAt(n)),0>r&&q(new sjcl.exception.invalid("this isn't base64!")),o>26?(o-=26,i.push(u^r>>>o),u=r<<32-o):(o+=6,u^=r<<32-o);return 56&o&&i.push(sjcl.bitArray.partial(56&o,u,1)),i}},sjcl.codec.base64url={fromBits:function(e){return sjcl.codec.base64.fromBits(e,1,1)},toBits:function(e){return sjcl.codec.base64.toBits(e,1)}},sjcl.hash.sha256=function(e){this.b[0]||this.D(),e?(this.r=e.r.slice(0),this.o=e.o.slice(0),this.h=e.h):this.reset()},sjcl.hash.sha256.hash=function(e){return(new sjcl.hash.sha256).update(e).finalize()},sjcl.hash.sha256.prototype={blockSize:512,reset:function(){return this.r=this.N.slice(0),this.o=[],this.h=0,this},update:function(e){"string"==typeof e&&(e=sjcl.codec.utf8String.toBits(e));var t,n=this.o=sjcl.bitArray.concat(this.o,e);for(t=this.h,e=this.h=t+sjcl.bitArray.bitLength(e),t=-512&512+t;e>=t;t+=512)z(this,n.splice(0,16));return this},finalize:function(){var e,t=this.o,n=this.r,t=sjcl.bitArray.concat(t,[sjcl.bitArray.partial(1,1)]);for(e=t.length+2;15&e;e++)t.push(0);for(t.push(Math.floor(this.h/4294967296)),t.push(0|this.h);t.length;)z(this,t.splice(0,16));return this.reset(),n},N:[],b:[],D:function(){function e(e){return 0|4294967296*(e-Math.floor(e))}var t,n=0,r=2;e:for(;64>n;r++){for(t=2;r>=t*t;t++)if(0===r%t)continue e;8>n&&(this.N[n]=e(Math.pow(r,.5))),this.b[n]=e(Math.pow(r,1/3)),n++}}},sjcl.mode.ccm={name:"ccm",encrypt:function(e,t,n,r,i){var o,s=t.slice(0),u=sjcl.bitArray,a=u.bitLength(n)/8,c=u.bitLength(s)/8;for(i=i||64,r=r||[],7>a&&q(new sjcl.exception.invalid("ccm: iv must be at least 7 bytes")),o=2;4>o&&c>>>8*o;o++);return 15-a>o&&(o=15-a),n=u.clamp(n,8*(15-o)),t=sjcl.mode.ccm.L(e,t,n,r,i,o),s=sjcl.mode.ccm.p(e,s,n,t,i,o),u.concat(s.data,s.tag)},decrypt:function(e,t,n,r,i){i=i||64,r=r||[];var o=sjcl.bitArray,s=o.bitLength(n)/8,u=o.bitLength(t),a=o.clamp(t,u-i),c=o.bitSlice(t,u-i),u=(u-i)/8;for(7>s&&q(new sjcl.exception.invalid("ccm: iv must be at least 7 bytes")),t=2;4>t&&u>>>8*t;t++);return 15-s>t&&(t=15-s),n=o.clamp(n,8*(15-t)),a=sjcl.mode.ccm.p(e,a,n,c,i,t),e=sjcl.mode.ccm.L(e,a.data,n,r,i,t),o.equal(a.tag,e)||q(new sjcl.exception.corrupt("ccm: tag doesn't match")),a.data},L:function(e,t,n,r,i,o){var s=[],u=sjcl.bitArray,a=u.l;if(i/=8,(i%2||4>i||i>16)&&q(new sjcl.exception.invalid("ccm: invalid tag length")),(4294967295<r.length||4294967295<t.length)&&q(new sjcl.exception.bug("ccm: can't deal with 4GiB or more data")),o=[u.partial(8,(r.length?64:0)|i-2<<2|o-1)],o=u.concat(o,n),o[3]|=u.bitLength(t)/8,o=e.encrypt(o),r.length)for(n=u.bitLength(r)/8,65279>=n?s=[u.partial(16,n)]:4294967295>=n&&(s=u.concat([u.partial(16,65534)],[n])),s=u.concat(s,r),r=0;r<s.length;r+=4)o=e.encrypt(a(o,s.slice(r,r+4).concat([0,0,0])));for(r=0;r<t.length;r+=4)o=e.encrypt(a(o,t.slice(r,r+4).concat([0,0,0])));return u.clamp(o,8*i)},p:function(e,t,n,r,i,o){var s,u=sjcl.bitArray;s=u.l;var a=t.length,c=u.bitLength(t);if(n=u.concat([u.partial(8,o-1)],n).concat([0,0,0]).slice(0,4),r=u.bitSlice(s(r,e.encrypt(n)),0,i),!a)return{tag:r,data:[]};for(s=0;a>s;s+=4)n[3]++,i=e.encrypt(n),t[s]^=i[0],t[s+1]^=i[1],t[s+2]^=i[2],t[s+3]^=i[3];return{tag:r,data:u.clamp(t,c)}}},sjcl.mode.ocb2={name:"ocb2",encrypt:function(e,t,n,r,i,o){128!==sjcl.bitArray.bitLength(n)&&q(new sjcl.exception.invalid("ocb iv must be 128 bits"));var s,u=sjcl.mode.ocb2.H,a=sjcl.bitArray,c=a.l,l=[0,0,0,0];n=u(e.encrypt(n));var f,d=[];for(r=r||[],i=i||64,s=0;s+4<t.length;s+=4)f=t.slice(s,s+4),l=c(l,f),d=d.concat(c(n,e.encrypt(c(n,f)))),n=u(n);return f=t.slice(s),t=a.bitLength(f),s=e.encrypt(c(n,[0,0,0,t])),f=a.clamp(c(f.concat([0,0,0]),s),t),l=c(l,c(f.concat([0,0,0]),s)),l=e.encrypt(c(l,c(n,u(n)))),r.length&&(l=c(l,o?r:sjcl.mode.ocb2.pmac(e,r))),d.concat(a.concat(f,a.clamp(l,i)))},decrypt:function(e,t,n,r,i,o){128!==sjcl.bitArray.bitLength(n)&&q(new sjcl.exception.invalid("ocb iv must be 128 bits")),i=i||64;var s,u,a=sjcl.mode.ocb2.H,c=sjcl.bitArray,l=c.l,f=[0,0,0,0],d=a(e.encrypt(n)),h=sjcl.bitArray.bitLength(t)-i,p=[];for(r=r||[],n=0;h/32>n+4;n+=4)s=l(d,e.decrypt(l(d,t.slice(n,n+4)))),f=l(f,s),p=p.concat(s),d=a(d);return u=h-32*n,s=e.encrypt(l(d,[0,0,0,u])),s=l(s,c.clamp(t.slice(n),u).concat([0,0,0])),f=l(f,s),f=e.encrypt(l(f,l(d,a(d)))),r.length&&(f=l(f,o?r:sjcl.mode.ocb2.pmac(e,r))),c.equal(c.clamp(f,i),c.bitSlice(t,h))||q(new sjcl.exception.corrupt("ocb: tag doesn't match")),p.concat(c.clamp(s,u))},pmac:function(e,t){var n,r=sjcl.mode.ocb2.H,i=sjcl.bitArray,o=i.l,s=[0,0,0,0],u=e.encrypt([0,0,0,0]),u=o(u,r(r(u)));for(n=0;n+4<t.length;n+=4)u=r(u),s=o(s,e.encrypt(o(u,t.slice(n,n+4))));return n=t.slice(n),128>i.bitLength(n)&&(u=o(u,r(u)),n=i.concat(n,[-2147483648,0,0,0])),s=o(s,n),e.encrypt(o(r(o(u,r(u))),s))},H:function(e){return[e[0]<<1^e[1]>>>31,e[1]<<1^e[2]>>>31,e[2]<<1^e[3]>>>31,e[3]<<1^135*(e[0]>>>31)]}},sjcl.mode.gcm={name:"gcm",encrypt:function(e,t,n,r,i){var o=t.slice(0);return t=sjcl.bitArray,r=r||[],e=sjcl.mode.gcm.p(!0,e,o,r,n,i||128),t.concat(e.data,e.tag)},decrypt:function(e,t,n,r,i){var o=t.slice(0),s=sjcl.bitArray,a=s.bitLength(o);return i=i||128,r=r||[],a>=i?(t=s.bitSlice(o,a-i),o=s.bitSlice(o,0,a-i)):(t=o,o=[]),e=sjcl.mode.gcm.p(u,e,o,r,n,i),s.equal(e.tag,t)||q(new sjcl.exception.corrupt("gcm: tag doesn't match")),e.data},Z:function(e,t){var n,r,i,o,s,u=sjcl.bitArray.l;for(i=[0,0,0,0],o=t.slice(0),n=0;128>n;n++){for((r=0!==(e[Math.floor(n/32)]&1<<31-n%32))&&(i=u(i,o)),s=0!==(1&o[3]),r=3;r>0;r--)o[r]=o[r]>>>1|(1&o[r-1])<<31;o[0]>>>=1,s&&(o[0]^=-520093696)}return i},g:function(e,t,n){var r,i=n.length;for(t=t.slice(0),r=0;i>r;r+=4)t[0]^=4294967295&n[r],t[1]^=4294967295&n[r+1],t[2]^=4294967295&n[r+2],t[3]^=4294967295&n[r+3],t=sjcl.mode.gcm.Z(t,e);return t},p:function(e,t,n,r,i,o){var s,u,a,c,l,f,d,h,p=sjcl.bitArray;for(f=n.length,d=p.bitLength(n),h=p.bitLength(r),u=p.bitLength(i),s=t.encrypt([0,0,0,0]),96===u?(i=i.slice(0),i=p.concat(i,[1])):(i=sjcl.mode.gcm.g(s,[0,0,0,0],i),i=sjcl.mode.gcm.g(s,i,[0,0,Math.floor(u/4294967296),4294967295&u])),u=sjcl.mode.gcm.g(s,[0,0,0,0],r),l=i.slice(0),r=u.slice(0),e||(r=sjcl.mode.gcm.g(s,u,n)),c=0;f>c;c+=4)l[3]++,a=t.encrypt(l),n[c]^=a[0],n[c+1]^=a[1],n[c+2]^=a[2],n[c+3]^=a[3];return n=p.clamp(n,d),e&&(r=sjcl.mode.gcm.g(s,u,n)),e=[Math.floor(h/4294967296),4294967295&h,Math.floor(d/4294967296),4294967295&d],r=sjcl.mode.gcm.g(s,r,e),a=t.encrypt(i),r[0]^=a[0],r[1]^=a[1],r[2]^=a[2],r[3]^=a[3],{tag:p.bitSlice(r,0,o),data:n}}},sjcl.misc.hmac=function(e,t){this.M=t=t||sjcl.hash.sha256;var n,r=[[],[]],i=t.prototype.blockSize/32;for(this.n=[new t,new t],e.length>i&&(e=t.hash(e)),n=0;i>n;n++)r[0][n]=909522486^e[n],r[1][n]=1549556828^e[n];this.n[0].update(r[0]),this.n[1].update(r[1]),this.G=new t(this.n[0])},sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.mac=function(e){return this.Q&&q(new sjcl.exception.invalid("encrypt on already updated hmac called!")),this.update(e),this.digest(e)},sjcl.misc.hmac.prototype.reset=function(){this.G=new this.M(this.n[0]),this.Q=u},sjcl.misc.hmac.prototype.update=function(e){this.Q=!0,this.G.update(e)},sjcl.misc.hmac.prototype.digest=function(){var e=this.G.finalize(),e=new this.M(this.n[1]).update(e).finalize();return this.reset(),e},sjcl.misc.pbkdf2=function(e,t,n,r,i){n=n||1e3,(0>r||0>n)&&q(sjcl.exception.invalid("invalid params to pbkdf2")),"string"==typeof e&&(e=sjcl.codec.utf8String.toBits(e)),"string"==typeof t&&(t=sjcl.codec.utf8String.toBits(t)),i=i||sjcl.misc.hmac,e=new i(e);var o,s,u,a,c=[],l=sjcl.bitArray;for(a=1;32*c.length<(r||1);a++){for(i=o=e.encrypt(l.concat(t,[a])),s=1;n>s;s++)for(o=e.encrypt(o),u=0;u<o.length;u++)i[u]^=o[u];c=c.concat(i)}return r&&(c=l.clamp(c,r)),c},sjcl.prng=function(e){this.c=[new sjcl.hash.sha256],this.i=[0],this.F=0,this.s={},this.C=0,this.K={},this.O=this.d=this.j=this.W=0,this.b=[0,0,0,0,0,0,0,0],this.f=[0,0,0,0],this.A=t,this.B=e,this.q=u,this.w={progress:{},seeded:{}},this.m=this.V=0,this.t=1,this.u=2,this.S=65536,this.I=[0,48,64,96,128,192,256,384,512,768,1024],this.T=3e4,this.R=80},sjcl.prng.prototype={randomWords:function(e,t){var n,r=[];n=this.isReady(t);var i;if(n===this.m&&q(new sjcl.exception.notReady("generator isn't seeded")),n&this.u){n=!(n&this.t),i=[];var o,s=0;for(this.O=i[0]=(new Date).valueOf()+this.T,o=0;16>o;o++)i.push(0|4294967296*Math.random());for(o=0;o<this.c.length&&(i=i.concat(this.c[o].finalize()),s+=this.i[o],this.i[o]=0,!(!n&&this.F&1<<o));o++);for(this.F>=1<<this.c.length&&(this.c.push(new sjcl.hash.sha256),this.i.push(0)),this.d-=s,s>this.j&&(this.j=s),this.F++,this.b=sjcl.hash.sha256.hash(this.b.concat(i)),this.A=new sjcl.cipher.aes(this.b),n=0;4>n&&(this.f[n]=0|this.f[n]+1,!this.f[n]);n++);}for(n=0;e>n;n+=4)0===(n+1)%this.S&&A(this),i=B(this),r.push(i[0],i[1],i[2],i[3]);return A(this),r.slice(0,e)},setDefaultParanoia:function(e,t){0===e&&"Setting paranoia=0 will ruin your security; use it only for testing"!==t&&q("Setting paranoia=0 will ruin your security; use it only for testing"),this.B=e},addEntropy:function(e,n,r){r=r||"user";var i,o,s=(new Date).valueOf(),u=this.s[r],a=this.isReady(),c=0;switch(i=this.K[r],i===t&&(i=this.K[r]=this.W++),u===t&&(u=this.s[r]=0),this.s[r]=(this.s[r]+1)%this.c.length,typeof e){case"number":n===t&&(n=1),this.c[u].update([i,this.C++,1,n,s,1,0|e]);break;case"object":if(r=Object.prototype.toString.call(e),"[object Uint32Array]"===r){for(o=[],r=0;r<e.length;r++)o.push(e[r]);e=o}else for("[object Array]"!==r&&(c=1),r=0;r<e.length&&!c;r++)"number"!=typeof e[r]&&(c=1);if(!c){if(n===t)for(r=n=0;r<e.length;r++)for(o=e[r];o>0;)n++,o>>>=1;this.c[u].update([i,this.C++,2,n,s,e.length].concat(e))}break;case"string":n===t&&(n=e.length),this.c[u].update([i,this.C++,3,n,s,e.length]),this.c[u].update(e);break;default:c=1}c&&q(new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string")),this.i[u]+=n,this.d+=n,a===this.m&&(this.isReady()!==this.m&&C("seeded",Math.max(this.j,this.d)),C("progress",this.getProgress()))},isReady:function(e){return e=this.I[e!==t?e:this.B],this.j&&this.j>=e?this.i[0]>this.R&&(new Date).valueOf()>this.O?this.u|this.t:this.t:this.d>=e?this.u|this.m:this.m},getProgress:function(e){return e=this.I[e?e:this.B],this.j>=e?1:this.d>e?1:this.d/e},startCollectors:function(){this.q||(this.a={loadTimeCollector:D(this,this.aa),mouseCollector:D(this,this.ba),keyboardCollector:D(this,this.$),accelerometerCollector:D(this,this.U)},window.addEventListener?(window.addEventListener("load",this.a.loadTimeCollector,u),window.addEventListener("mousemove",this.a.mouseCollector,u),window.addEventListener("keypress",this.a.keyboardCollector,u),window.addEventListener("devicemotion",this.a.accelerometerCollector,u)):document.attachEvent?(document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector)):q(new sjcl.exception.bug("can't attach event")),this.q=!0)},stopCollectors:function(){this.q&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,u),window.removeEventListener("mousemove",this.a.mouseCollector,u),window.removeEventListener("keypress",this.a.keyboardCollector,u),window.removeEventListener("devicemotion",this.a.accelerometerCollector,u)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.q=u)},addEventListener:function(e,t){this.w[e][this.V++]=t},removeEventListener:function(e,t){var n,r,i=this.w[e],o=[];for(r in i)i.hasOwnProperty(r)&&i[r]===t&&o.push(r);for(n=0;n<o.length;n++)r=o[n],delete i[r]},$:function(){E(1)},ba:function(e){sjcl.random.addEntropy([e.x||e.clientX||e.offsetX||0,e.y||e.clientY||e.offsetY||0],2,"mouse"),E(0)},aa:function(){E(2)},U:function(e){e=e.accelerationIncludingGravity.x||e.accelerationIncludingGravity.y||e.accelerationIncludingGravity.z;var t="";window.orientation&&(t=window.orientation),sjcl.random.addEntropy([e,t],3,"accelerometer"),E(0)}},sjcl.random=new sjcl.prng(6);e:try{var F,G,H;if("undefined"!=typeof module&&module.exports)G=require("crypto"),F=G.randomBytes(128),sjcl.random.addEntropy(F,1024,"crypto['randomBytes']");else if(window&&Uint32Array){if(H=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(H);else{if(!window.msCrypto||!window.msCrypto.getRandomValues)break e;window.msCrypto.getRandomValues(H)}sjcl.random.addEntropy(H,1024,"crypto['getRandomValues']")}}catch(I){console.log("There was an error collecting entropy from the browser:"),console.log(I)}sjcl.json={defaults:{v:1,iter:1e3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},Y:function(e,t,n,r){n=n||{},r=r||{};var i,o=sjcl.json,s=o.e({iv:sjcl.random.randomWords(4,0)},o.defaults);return o.e(s,n),n=s.adata,"string"==typeof s.salt&&(s.salt=sjcl.codec.base64.toBits(s.salt)),"string"==typeof s.iv&&(s.iv=sjcl.codec.base64.toBits(s.iv)),(!sjcl.mode[s.mode]||!sjcl.cipher[s.cipher]||"string"==typeof e&&100>=s.iter||64!==s.ts&&96!==s.ts&&128!==s.ts||128!==s.ks&&192!==s.ks&&256!==s.ks||2>s.iv.length||4<s.iv.length)&&q(new sjcl.exception.invalid("json encrypt: invalid parameters")),"string"==typeof e?(i=sjcl.misc.cachedPbkdf2(e,s),e=i.key.slice(0,s.ks/32),s.salt=i.salt):sjcl.ecc&&e instanceof sjcl.ecc.elGamal.publicKey&&(i=e.kem(),s.kemtag=i.tag,e=i.key.slice(0,s.ks/32)),"string"==typeof t&&(t=sjcl.codec.utf8String.toBits(t)),"string"==typeof n&&(n=sjcl.codec.utf8String.toBits(n)),i=new sjcl.cipher[s.cipher](e),o.e(r,s),r.key=e,s.ct=sjcl.mode[s.mode].encrypt(i,t,s.iv,n,s.ts),s},encrypt:function(){var e=sjcl.json,t=e.Y.apply(e,arguments);return e.encode(t)},X:function(e,t,n,r){n=n||{},r=r||{};var i=sjcl.json;t=i.e(i.e(i.e({},i.defaults),t),n,!0);var o;return n=t.adata,"string"==typeof t.salt&&(t.salt=sjcl.codec.base64.toBits(t.salt)),"string"==typeof t.iv&&(t.iv=sjcl.codec.base64.toBits(t.iv)),(!sjcl.mode[t.mode]||!sjcl.cipher[t.cipher]||"string"==typeof e&&100>=t.iter||64!==t.ts&&96!==t.ts&&128!==t.ts||128!==t.ks&&192!==t.ks&&256!==t.ks||!t.iv||2>t.iv.length||4<t.iv.length)&&q(new sjcl.exception.invalid("json decrypt: invalid parameters")),"string"==typeof e?(o=sjcl.misc.cachedPbkdf2(e,t),e=o.key.slice(0,t.ks/32),t.salt=o.salt):sjcl.ecc&&e instanceof sjcl.ecc.elGamal.secretKey&&(e=e.unkem(sjcl.codec.base64.toBits(t.kemtag)).slice(0,t.ks/32)),"string"==typeof n&&(n=sjcl.codec.utf8String.toBits(n)),o=new sjcl.cipher[t.cipher](e),n=sjcl.mode[t.mode].decrypt(o,t.ct,t.iv,n,t.ts),i.e(r,t),r.key=e,sjcl.codec.utf8String.fromBits(n)},decrypt:function(e,t,n,r){var i=sjcl.json;return i.X(e,i.decode(t),n,r)},encode:function(e){var t,n="{",r="";for(t in e)if(e.hasOwnProperty(t))switch(t.match(/^[a-z0-9]+$/i)||q(new sjcl.exception.invalid("json encode: invalid property name")),n+=r+'"'+t+'":',r=",",typeof e[t]){case"number":case"boolean":n+=e[t];break;case"string":n+='"'+escape(e[t])+'"';break;case"object":n+='"'+sjcl.codec.base64.fromBits(e[t],0)+'"';break;default:q(new sjcl.exception.bug("json encode: unsupported type"))}return n+"}"},decode:function(e){e=e.replace(/\s/g,""),e.match(/^\{.*\}$/)||q(new sjcl.exception.invalid("json decode: this isn't json!")),e=e.replace(/^\{|\}$/g,"").split(/,/);var t,n,r={};for(t=0;t<e.length;t++)(n=e[t].match(/^(?:(["']?)([a-z][a-z0-9]*)\1):(?:(\d+)|"([a-z0-9+\/%*_.@=\-]*)")$/i))||q(new sjcl.exception.invalid("json decode: this isn't json!")),r[n[2]]=n[3]?parseInt(n[3],10):n[2].match(/^(ct|salt|iv)$/)?sjcl.codec.base64.toBits(n[4]):unescape(n[4]);return r},e:function(e,n,r){if(e===t&&(e={}),n===t)return e;for(var i in n)n.hasOwnProperty(i)&&(r&&e[i]!==t&&e[i]!==n[i]&&q(new sjcl.exception.invalid("required parameter overridden")),e[i]=n[i]);return e},ea:function(e,t){var n,r={};for(n in e)e.hasOwnProperty(n)&&e[n]!==t[n]&&(r[n]=e[n]);return r},da:function(e,n){var r,i={};for(r=0;r<n.length;r++)e[n[r]]!==t&&(i[n[r]]=e[n[r]]);return i}},sjcl.encrypt=sjcl.json.encrypt,sjcl.decrypt=sjcl.json.decrypt,sjcl.misc.ca={},sjcl.misc.cachedPbkdf2=function(e,n){var r,i=sjcl.misc.ca;return n=n||{},r=n.iter||1e3,i=i[e]=i[e]||{},r=i[r]=i[r]||{firstSalt:n.salt&&n.salt.length?n.salt.slice(0):sjcl.random.randomWords(2,0)},i=n.salt===t?r.firstSalt:n.salt,r[i]=r[i]||sjcl.misc.pbkdf2(e,i,n.iter),{key:r[i].slice(0),salt:i.slice(0)}},define("sjcl",function(e){return function(){var t;return t||e.sjcl}}(this)),define("crypto/index",["sjcl"],function(e){return{hash:function(t){var n=e.hash.sha256.hash(JSON.stringify(t));return e.codec.hex.fromBits(n)}}}),define("settings",["lodash","./uuid"],function(e,t){function n(){return JSON.parse(localStorage.getItem(i))||{}}function r(){localStorage.setItem(i,JSON.stringify(o))}var i="settings",o=n();return Object.observe(o,r),e.defaults(o,{i18n:"en_GB",uuid:t.generate(),authToken:t.generate(),maxWorkers:2,fileStorageSize:524288e3}),o.uuid=t.generate(),o}),define("storage/filesystem",["lodash","crypto/index","q","project","settings"],function(e,t,n,r,i){function o(){var e=n.defer();return window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.requestFileSystem(window.PERSISTENT,i.fileStorageSize,e.resolve,function(t){e.reject(t)}),e.promise}function s(){var e=n.defer();return navigator.webkitPersistentStorage=navigator.webkitPersistentStorage||window.webkitStorageInfo,navigator.webkitPersistentStorage.requestQuota(i.fileStorageSize||52428800,e.resolve,e.reject),e.promise}function u(e){var t=new RegExp(/[^\\/]+$/);return e.match(t)[0]}function a(e){var t=n.defer();return p.root.getDirectory(e,{create:!0},t.resolve,t.reject),t.promise}function c(e){var t,r=n.defer(),i=new XMLHttpRequest;return i.open("GET",e.uri,!0),i.responseType="blob",i.addEventListener("progress",function(e){t=e.target.response instanceof Blob?{blob:e.target.response,position:e.position,totalSize:e.totalSize}:{totalSize:e.totalSize},r.notify(t)}),i.addEventListener("load",function(e){200===i.status?(t={blob:e.target.response,position:e.position,totalSize:e.target.response.size},r.resolve(t)):r.reject("Error downloading file")},!1),i.send(),r.promise}function l(){return d.getFileList().then(function(e){d.list=e})}function f(e,t){t=t||"";for(var n=atob(e),r=[],i=0;i<n.length;i+=g){for(var o=n.slice(i,i+g),s=new Array(o.length),u=0;u<o.length;u++)s[u]=o.charCodeAt(u);var a=new Uint8Array(s);r.push(a)}return new Blob(r,{type:t})}var d,h,p,g=512;return{list:null,init:function(e){return d=this,h=e,s().then(o).then(function(e){return p=e,a(r.uuid)}).then(function(){return l()})},write:function(e,t,i){var o=n.defer(),s=0,u=!0;return!t instanceof Blob&&(t=f(t)),h.read("files",e.uuid,{uuidIsHash:!0}).then(function(t){e=t,(!e||e.isComplete)&&o.reject("File does not exist, or is already complete"),s=e.position,u=0===s,s>i&&o.reject("Position is lower than already written bytes!")}).then(function(){p.root.getFile(r.uuid+"/"+e.uuid,{create:u},function(e){e.createWriter(function(e){i=i||e.length,e.seek(i),e.write(t)},o.reject)},o.reject)}).then(function(){var n=e.position+t.size;return h.update("files",{uuid:e.uuid,isComplete:n>=e.size,position:n},{uuidIsHash:!0})}).then(l),o.promise},readFileAsLocalUrl:function(e){var t=n.defer();return p.root.getFile(r.uuid+"/"+e.uuid,{},function(e){t.resolve(e.toURL())},t.reject),t.promise},readFileChunkAsBlob:function(e,t){var i=n.defer();return p.root.getFile(r.uuid+"/"+e.uuid,{},function(e){e.file(function(e){var n,r=t||0,o=r+g;r+g>e.size&&(o=e.size),n=e.slice(r,o),i.resolve(n)},i.reject)},i.reject),i.promise},readFileChunkAsDataUrl:function(e,t){var i=n.defer();return p.root.getFile(r.uuid+"/"+e.uuid,{},function(e){e.file(function(e){var n,r,o=new FileReader,s=t||0,u=s+g;s+g>e.size&&(u=e.size),n=e.slice(s,u),o.onloadend=function(e){e.target.readyState===FileReader.DONE?(r=o.result.match(/,(.*)$/),r?(i.resolve(r[1]),o=null):i.reject()):i.reject()},o.readAsDataURL(n)},i.reject)},i.reject),i.promise},add:function(r){var i=[];return e.isArray(r)||(r=[r]),r.forEach(function(e){var n={name:u(e),uri:e,size:0,position:0,isComplete:!1,uuid:t.hash(e)},r=h.read("files",n.uuid,{uuidIsHash:!0}).then(function(e){return e?void 0:h.save("files",n,{allowDuplicates:!1,uuidIsHash:!0})});i.push(r)}),n.all(i).then(l)},getIncompleteFileList:function(){return h.findAndReduceByObject("files",{filterDuplicates:!1},{projectUuid:r.uuid,isComplete:!1})},getFileList:function(){return h.findAndReduceByObject("files",{filterDuplicates:!1},{projectUuid:r.uuid})},downloadIncompleteFiles:function(){return this.getIncompleteFileList().then(function(e){var t=[];return e.forEach(function(e){var n=c(e).progress(function(t){t.blob&&t.position?h.update("files",{uuid:e.uuid,size:t.totalSize,position:t.position},{uuidIsHash:!0}).then(function(){d.write(e,t.blob,t.position)}):h.update("files",{uuid:e.uuid,size:t.totalSize},{uuidIsHash:!0})}).catch(function(){logger.error("FileStorage",e.uri,"error during download!")}).done(function(t){return logger.log("FileStorage",e.uri,"download complete!"),h.update("files",{uuid:e.uuid,isComplete:!0,position:t.blob.size,size:t.blob.size},{uuidIsHash:!0}),d.write(e,t.blob).then(l)});t.push(n)}),n.all(t)})},getFileInfoByUuid:function(e){return h.read("files",e,{uuidIsHash:!0})},getFileInfoByUri:function(e){return h.findAndReduceByObject("files",{},{uri:e})},clear:function(){var e=n.defer();return p.root.getDirectory(r.uuid,{},function(t){t.removeRecursively(function(){e.resolve()},e.reject)},e.reject),e.promise.then(d.getFileList).then(function(e){var t=[];return e.forEach(function(e){t.push(h.remove("files",e.uuid,{uuidIsHash:!0}))}),n.all(t)}).then(function(){return logger.log("FileStorage","removed all files/folders from file-system!"),l()})}}}),define("storage/index",["q","./database","./filesystem","project","muskepeer-module"],function(e,t,n,r,i){function o(t){var n=e.defer();return u.db.findAndReduceByObject(t,{filterDuplicates:!1},{projectUuid:r.uuid}).then(function(e){n.resolve(_.map(e,function(e){return e.uuid}))}),n.promise}function s(t,n){var r=e.defer();return o(t).then(function(e){r.resolve(_.difference(n,e))}),r.promise}var u=new i;return u.extend({init:function(){return t.init().then(function(){return logger.log("Database","ready"),n.init(t)}).then(function(){logger.log("FileSystem","ready"),u.db=t,u.fs=n,u.isReady=!0})},isReady:!1,db:null,fs:null,getFileUuidsAsArray:function(){return o("files")},getJobUuidsAsArray:function(){return o("jobs")},getResultUuidsAsArray:function(){return o("results")},getMissingFileUuidsAsArray:function(e){return s("files",e)},getMissingJobUuidsAsArray:function(e){return s("jobs",e)},getMissingResultUuidsAsArray:function(e){return s("results",e)}})}),define("computation/model/worker",["eventemitter2"],function(e){function t(e){logger.log("Worker","error occured",e)}var n,r,i=window.Worker,o=new e({delimiter:":"});return function(e){function s(e){switch(console.log(e.data),e.data.type.toLowerCase()){case"result":o.emit("result",e.data.data);break;case"error":o.emit("error",e.data.data);break;case"dependency":o.emit("dependency",e.data.data)}}this.id=null,this.emit=o.emit,this.on=o.on,this.off=o.off,this.any=o.any,this.isRunning=!1,this.isPaused=!1,this.start=function(){n=new i(e),n.addEventListener("message",s),n.addEventListener("error",t),this.isRunning=!0,this.isPaused=!1,r?this.process(r):this.emit("job",this.id)},this.stop=function(){n.postMessage({cmd:"stop"}),n.terminate(),n=null,this.isRunning=!1,this.isPaused=!0},this.pause=function(){n.postMessage({cmd:"pause"}),this.isPaused=!0,this.isRunning=!1},this.resume=function(){n.postMessage({cmd:"resume"}),this.isPaused=!1,this.isRunning=!0},this.process=function(e){this.isRunning&&!this.isPaused&&(r=e,n.postMessage({cmd:"process",job:e}))}}}),define("computation/collection/workers",["../model/worker"],function(e){var t=2,n=[];return{size:n.length||0,create:function(r){for(var i=this,o=0;t>o;o++){var s=new e(r);s.id=o+1,s.on("job",function(e){logger.log("Worker "+e,"needs job"),i.getWorkerById(e).process({foo:"bar"})}),s.on("result",function(e,t){logger.log("Worker "+e,t,"has result")}),n.push(s)}},getWorkerById:function(e){return n[e-1]},start:function(){n.forEach(function(e){e.start()})},stop:function(){n.forEach(function(e){e.stop()})},pause:function(){n.forEach(function(e){e.pause()})},resume:function(){n.forEach(function(e){e.resume()})}}}),define("computation/collection/jobs",[],function(){var e=[];return{list:e,size:e.length,add:function(t){t.uuid&&null==this.getJobByUuid(t.uuid)&&(e.push(t),this.size=e.length)},clear:function(){e=[],this.size=0},getNext:function(){return e.shift()},getJobByUuid:function(t){return _.find(e,function(e){return e.uuid===t})},remove:function(){this.size=e.length}}}),define("computation/model/job",["crypto/index"],function(e){return function(t){return this.parameters=t,this.uuid=e.hash(this.parameters),console.log(this.parameters,this.uuid),this
}}),define("computation/index",["muskepeer-module","../storage/index","../project","./collection/workers","./collection/jobs","./model/job"],function(e,t,n,r,i,o){function s(){r.on("job:required"),r.on("job:complete"),r.on("job:started"),r.on("result:required"),r.on("result:found"),r.on("data:required")}var u=new e;return u.extend({isRunning:!1,isPaused:!1,jobs:i,start:function(){t.findAndReduceByObject("jobs",{filterDuplicates:!1},{projectUuid:n.uuid}).progress(function(e){i.add(e)}).then(function(e){logger.log("Computation","read all local jobs",e.length),0===r.size&&(r.create("./worker.js"),this.isRunning=!0,this.isPaused=!1),0===i.size&&n.computation.jobs.autoGeneration&&u.createAndStoreJobs(n.computation.jobs.groupSize),s(),logger.log("Computation","workers starting"),r.start()})},pause:function(){r.pause(),this.isPaused=!0},resume:function(){r.resume(),this.isPaused=!1},stop:function(){r.stop(),this.isRunning=!1},createAndStoreJobs:function(e){for(var r,s=0;e>s;s++)r=new o(n.computation.jobs.createJobParameters(s)),i.add(r);this.jobs=i,t.saveMultiple("jobs",i.list,{allowDuplicates:!1,uuidIsHash:!0}).then(function(){console.log("Jobs saved")})}})}),define("geolocation",["q","project"],function(e,t){function n(e){return e*(Math.PI/180)}var r=6371,i=null;return{getGeoLocation:function(){var n=e.defer();return t.network.useGeoLocation?t.network.useGeoLocation&&i?n.resolve(i):navigator.geolocation.getCurrentPosition(function(e){i={lat:e.coords.latitude,"long":e.coords.longitude},n.resolve(i)},function(){n.resolve(i?i:null)},{enableHighAccuracy:!0}):n.resolve(null),n.promise},getDistanceBetweenTwoLocations:function(e,t){t=t||i;var o=n(t.lat-t.lat),s=n(t.long-e.long),u=Math.sin(o/2)*Math.sin(o/2)+Math.cos(n(t.lat))*Math.cos(n(t.lat))*Math.sin(s/2)*Math.sin(s/2),a=2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u));return r*a}}}),define("network/model/node",["lodash","q","eventemitter2","settings","project","geolocation"],function(e,t,n,r,i,o){var s=new n({wildcard:!0,delimiter:":",newListener:!1,maxListeners:10}),u=function(n){var u=this;this.emit=s.emit,this.on=s.on,this.off=s.off,this.onAny=s.onAny,this.host=n.host||"localhost",this.port=n.port||8080,this.isSecure=n.isSecure||!1,this.url=null,this.id=0,this.uuid=n.uuid,this.socket=null,this.isConnected=!1,this.connect=function(e){try{this.socket=new WebSocket((this.isSecure?"wss":"ws")+"://"+this.host+":"+this.port),this.url=this.socket.url,this.socket.addEventListener("message",this.messageHandler),this.socket.addEventListener("open",function(){logger.log("Node"+u.id+" "+u.url,"connected"),u.isConnected=!0,e()}),this.socket.addEventListener("error",function(){u.disconnect(),logger.log("Node"+u.id+" "+u.url,"error")}),this.socket.addEventListener("close",function(e){switch(u.disconnect(),logger.log("Node"+u.id+" "+u.url,"disconnected",e.code+" : "+e.reason),e.code){case 1011:logger.log("Node"+u.id+" "+u.url,"is idle! Please restart it.")}})}catch(t){u.disconnect()}return this},this.disconnect=function(){return this.socket=null,this.isConnected=!1,this},this.send=function(n,i,o){var s=t.defer();return this.isConnected?i&&e.isObject(i)&&!e.isEmpty(i)?n?(i.cmd=n,i.authToken=r.authToken,this.socket.send(JSON.stringify(i)),o?this.socket.addEventListener("message",function(e){var t=JSON.parse(e.data);t.cmd===n&&s.resolve(t.data)}):s.resolve(),s.promise):(s.reject("Command is not defined!"),s.promise):(s.reject("Data is not an object/empty!"),s.promise):(s.reject("Not connected to node!"),s.promise)},this.sendAuthentication=function(){return o.getGeoLocation().then(function(e){return u.send("peer:auth",{uuid:r.uuid,location:e},!0)})},this.sendPeerOffer=function(e,t){return o.getGeoLocation().then(function(n){u.send("peer:offer",{uuid:r.uuid,targetPeerUuid:e,offer:t,location:n},!1)})},this.sendPeerAnswer=function(e,t){return this.send("peer:answer",{uuid:r.uuid,targetPeerUuid:e,answer:t},!1)},this.sendPeerCandidate=function(e,t){return this.send("peer:candidate",{uuid:r.uuid,targetPeerUuid:e,candidate:t},!1)},this.getAllRelatedPeers=function(){return this.send("peer:list",{projectUuid:i.uuid},!0)},this.messageHandler=function(e){var t=JSON.parse(e.data),n=t.cmd;switch(logger.log("Node"+u.id,"received",t),n.toLowerCase()){case"peer:offer":u.emit("peer:offer",{nodeUuid:u.uuid,targetPeerUuid:t.data.targetPeerUuid,offer:t.data.offer,location:t.data.location});break;case"peer:answer":u.emit("peer:answer",{nodeUuid:u.uuid,targetPeerUuid:t.data.targetPeerUuid,answer:t.data.answer});break;case"peer:candidate":u.emit("peer:candidate",{nodeUuid:u.uuid,targetPeerUuid:t.data.targetPeerUuid,candidate:t.data.candidate})}},this.serialize=function(){return{host:this.host,isSecure:this.isSecure,port:this.port}}};return u}),define("network/collections/nodes",["q","../model/node","../../muskepeer-module"],function(e,t,n){var r=[],i=new n;return i.extend({list:r,connect:function(){var t=[];return logger.log("Nodes","connect"),r.forEach(function(n){var r=e.defer();n.connect(function(){r.resolve()}),t.push(r.promise)}),e.all(t)},update:function(e){var n;e.forEach(function(e){n=new t(e),n.id=r.length+1,n.onAny(function(e){i.emit(this.event,e)}),r.push(n)})},getNodeByUrl:function(e){return _.find(r,function(t){return t.url===e})},getNodeUuidsAsArray:function(){return _.map(r,function(e){return e.uuid})},getMissingNodeUuidsAsArray:function(e){var t=i.getNodeUuidsAsArray();return _.difference(e,t)},getNodeByUuid:function(e){return _.find(r,function(t){return t.uuid===e})},authenticate:function(){var t=[];return logger.log("Nodes","authenticate"),r.forEach(function(n){var r=e.defer();n.sendAuthentication().then(function(){r.resolve()}),t.push(r.promise)}),e.all(t)},getRelatedPeers:function(){var t=[];return r.forEach(function(n){var r=e.defer();n.getAllRelatedPeers().then(function(e){e.forEach(function(e){e.nodes=[n.uuid]}),r.resolve(e)}),t.push(r.promise)}),e.all(t)}})}),define("network/model/peer",["lodash","q","eventemitter2","../collections/nodes"],function(e,t,n,r){function i(e,t){return window.mozRTCPeerConnection?new mozRTCPeerConnection(e,t):window.webkitRTCPeerConnection?new webkitRTCPeerConnection(e,t):new RTCPeerConnection(e,t)}function o(e){return window.mozRTCIceCandidate?new mozRTCIceCandidate(e):new RTCIceCandidate(e)}function s(e){return window.mozRTCSessionDescription?new mozRTCSessionDescription(e):new RTCSessionDescription(e)}var u={iceServers:[{url:"stun:stun.l.google.com:19302"}]},a={optional:[{RtpDataChannels:!0}]},c={optional:[],mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},l=new n({wildcard:!0,delimiter:":",newListener:!1,maxListeners:10}),f=function(n){function f(e){if(e&&e.candidate){var t=j.getSignalChannel();t.sendPeerCandidate(j.uuid,e.candidate)}}function d(){}function h(e){logger.log("Peer",j.uuid," got remote datachannel"),w=e.channel,w.onclose=y,w.onerror=g,w.onmessage=m,w.onopen=v}function p(){"connected"===b.iceConnectionState&&"complete"===b.iceGatheringState?logger.log("Peer","connection established"):logger.log("Peer",j.uuid,"connection closed")}function g(e){logger.log("Peer",j.uuid,"channel has an error",e)}function m(t){var n;n=t.data instanceof Blob?t.data:JSON.parse(t.data),j.emit("peer:message",e.extend(n,{target:j}))}function v(){logger.log("Peer",j.uuid,"data-channel is open"),j.isConnected=!0,j.emit("peer:connect",j)}function y(){logger.log("Peer",j.uuid," data-channel is closed"),j.isConnected=!1,j.emit("peer:disconnect",j)}var b,w,j=this;this.emit=l.emit,this.on=l.on,this.off=l.off,this.onAny=l.onAny,this.isConnected=!1,this.isSource=n.isSource||!1,this.isTarget=n.isTarget||!1,this.uuid=n.uuid,this.location=n.location,this.distance=void 0,this.nodes=n.nodes||[],this.getSignalChannel=function(){var t;t=e.intersection(r.getNodeUuidsAsArray(),this.nodes);do t=r.getNodeByUuid(t.shift());while(!t.isConnected);return t},b=new i(u,a),b.ondatachannel=h,b.onicecandidate=f,b.oniceconnectionstatechange=p,b.onnegotiationneeded=d,this.createConnection=function(){logger.log("Peer",j.uuid,"creating connection"),this.isSource=!0,this.isTarget=!1,w=b.createDataChannel("RTCDataChannel"+(0|1e3*Math.random()),{reliable:!0}),w.onclose=y,w.onerror=g,w.onmessage=m,w.onopen=v;var e=t.defer,n=this.getSignalChannel();return b.createOffer(function(e){b.setLocalDescription(e),n.sendPeerOffer(j.uuid,e)},function(e){logger.log(e)},c),e.promise},this.answerOffer=function(e){var n=this.uuid,r=t.defer,i=this.getSignalChannel();return b.setRemoteDescription(new s(e.offer),function(){b.createAnswer(function(e){b.setLocalDescription(e),i.sendPeerAnswer(n,e)},function(e){logger.log(e)},c)}),r.promise},this.acceptConnection=function(e){this.isTarget=!0,this.isSource=!1,b.setRemoteDescription(new s(e.answer))},this.addCandidate=function(e){b.addIceCandidate(new o(e.candidate))},this.addNodes=function(e){e.forEach(function(e){j.nodes.indexOf(e)<0&&j.nodes.push(e)})},this.send=function(e){return this.isConnected&&"open"===w.readyState?(e instanceof Blob?w.send(e):w.send(JSON.stringify(e)),void 0):(logger.err("Peer","attempt to send, but channel is not open!"),void 0)},this.synchronize=function(){logger.log("Peer",this.uuid,"synchronizing"),this.getNodeList(),this.getPeerList(),this.getFileList(),this.getJobList(),this.getResultList()},this.getFileList=function(){this.send({type:"file:list:pull"})},this.sendFileList=function(e){this.send({type:"file:list:push",list:e})},this.getFileByUuid=function(t){e.isArray(t)||(t=[t]),t.forEach(function(e){j.send({type:"file:pull",uuid:e})})},this.sendFile=function(e,t,n){n=n||0,t instanceof Blob?(this.send({type:"file:push:start",uuid:e,pos:n}),this.send(t),this.send({type:"file:push:end",uuid:e})):this.send({type:"file:push",uuid:e,chunk:t,pos:n})},this.fileReceiveHandler=function(){},this.getNodeList=function(){this.send({type:"node:list:pull"})},this.sendNodeList=function(e){this.send({type:"node:list:push",list:e})},this.getNodeByUuid=function(t){e.isArray(t)||(t=[t]),t.forEach(function(e){j.send({type:"node:pull",uuid:e})})},this.sendNode=function(t){e.isArray(t)||(t=[t]),t.forEach(function(e){j.send({type:"node:push",node:e})})},this.getPeerList=function(){this.send({type:"peer:list:pull"})},this.sendPeerList=function(e){this.send({type:"peer:list:push",list:e})},this.getPeerByUuid=function(t){e.isArray(t)||(t=[t]),t.forEach(function(e){j.send({type:"peer:pull",uuid:e})})},this.sendPeer=function(t){e.isArray(t)||(t=[t]),t.forEach(function(e){j.send({type:"peer:push",peer:e})})},this.getJobList=function(){this.send({type:"job:list:pull"})},this.sendJobList=function(e){this.send({type:"job:list:push",list:e})},this.getJobByUuid=function(t){e.isArray(t)||(t=[t]),t.forEach(function(e){j.send({type:"job:pull",uuid:e})})},this.sendJob=function(t){e.isArray(t)||(t=[t]),t.forEach(function(e){j.send({type:"job:push",job:e})})},this.getResultList=function(){this.send({type:"result:list:pull"})},this.sendResultList=function(e){this.send({type:"result:list:push",list:e})},this.getResultByUuid=function(t){e.isArray(t)||(t=[t]),t.forEach(function(e){j.send({type:"result:pull",uuid:e})})},this.sendResult=function(t){e.isArray(t)||(t=[t]),t.forEach(function(e){j.send({type:"result:push",result:e})})},this.serialize=function(){return{uuid:this.uuid,location:this.location,nodes:this.nodes}}};return f}),define("network/collections/peers",["q","lodash","settings","geolocation","../../muskepeer-module","../model/peer"],function(e,t,n,r,i,o){function s(){return f.length>=1?f[0]:null}function u(){return f.length>=2?f[1]:1==f.length?f[0]:null}var a,c,l=new i,f=[];return l.extend({list:f,add:function(e){l.getPeerByUuid(e.uuid)||f.push(e)},connect:function(r){r=r||f;var i=[];return t.each(r,function(e){e&&e.uuid!==n.uuid&&i.push(e.createConnection())}),e.all(i)},connectToNeighbourPeers:function(){var e=l.getNeighbourPeers();return e[0]===e[1]?l.connect([e[0]]):l.connect(l.getNeighbourPeers())},getPeerByUuid:function(e){return t.find(f,function(t){return t.uuid===e})},getNeighbourPeers:function(){return[this.getNextPeer(),this.getPreviousPeer()]},getNextPeer:function(){return a||(a=s()),a},getPreviousPeer:function(){return c||(c=u()),c},getPeerUuidsAsArray:function(){return t.map(f,function(e){return e.uuid})},getMissingPeerUuidsAsArray:function(e){var r=l.getPeerUuidsAsArray();return r.push(n.uuid),t.difference(e,r)},update:function(e){logger.log("Peers","update"),e=t.flatten(e),e.forEach(function(e){if(e.uuid!==n.uuid){var t=l.getPeerByUuid(e.uuid);if(t)return t.addNodes(e.nodes),void 0;t=new o(e),l.add(t),t.onAny(function(e){l.emit(this.event,e)}),t.distance=r.getDistanceBetweenTwoLocations(t.location)}}),f=t.sortBy(f,function(e){return e.distance})},broadcast:function(e,t){f.forEach(function(n){n.isConnected&&n.send(e,t)})}})}),define("network/index",["q","lodash","storage/index","project","settings","geolocation","muskepeer-module","./collections/nodes","./collections/peers"],function(e,t,n,r,i,o,s,u,a){function c(e){"online"===e.type?logger.log("Network","online!"):logger.warn("Network","offline!")}function l(e){var t=a.getPeerByUuid(e.targetPeerUuid);t||(a.update([{uuid:e.targetPeerUuid,nodes:[e.nodeUuid],location:e.location,isSource:!0,isTarget:!1}]),t=a.getPeerByUuid(e.targetPeerUuid)),t.answerOffer(e)}function f(e){var t=a.getPeerByUuid(e.targetPeerUuid);t.acceptConnection(e)}function d(e){var t=a.getPeerByUuid(e.targetPeerUuid);t.addCandidate(e)}function h(){}function p(e){var t,r=e.target,i=e.list,o=e.uuid;if(!e.type)return logger.log("Network","peer:message without type received"),void 0;switch(e.type.toLowerCase()){case"node:list:pull":r.sendNodeList(u.getNodeUuidsAsArray());break;case"peer:list:pull":r.sendPeerList(a.getPeerUuidsAsArray());break;case"file:list:pull":n.getFileUuidsAsArray().then(function(e){r.sendFileList(e)});break;case"job:list:pull":n.getJobUuidsAsArray().then(function(e){r.sendJobList(e)});break;case"result:list:pull":n.getResultUuidsAsArray().then(function(e){r.sendResultList(e)});break;case"node:list:push":t=u.getMissingNodeUuidsAsArray(i),logger.log("Network","node:sync with "+r.uuid,t.length,"differences."),r.getNodeByUuid(t);break;case"peer:list:push":t=a.getMissingPeerUuidsAsArray(i),logger.log("Network","peer:sync with "+r.uuid,t.length,"differences."),r.getPeerByUuid(t);break;case"file:list:push":n.getMissingFileUuidsAsArray(i).then(function(e){logger.log("Network","file:sync with "+r.uuid,e.length,"differences."),r.getFileByUuid(e)});break;case"job:list:push":n.getMissingJobUuidsAsArray(i).then(function(e){logger.log("Network","job:sync with "+r.uuid,e.length,"differences."),r.getJobByUuid(e)});break;case"result:list:push":n.getMissingResultUuidsAsArray(i).then(function(e){logger.log("Network","result:sync with "+r.uuid,e.length,"differences."),r.getResultByUuid(e)});break;case"node:pull":r.sendPeer(u.getNodeByUuid(o).serialize());break;case"peer:pull":r.sendPeer(a.getPeerByUuid(o).serialize());break;case"file:pull":break;case"job:pull":break;case"result:pull":break;case"node:push":u.update(e.node);break;case"peer:push":a.update(e.peer);break;case"file:push":break;case"job:push":break;case"result:push":}}var g=new s;return window.addEventListener("offline",c),window.addEventListener("online",c),g.extend({isOnline:window.navigator.onLine,nodes:u,peers:a,start:function(){return g.isOnline?(u.on("peer:offer",l),u.on("peer:answer",f),u.on("peer:candidate",d),a.on("peer:connect",function(e){e.synchronize()}),a.on("peer:message",p),a.on("peer:disconnect",h),o.getGeoLocation().then(function(){return logger.log("Geolocation","available"),n.db.findAndReduceByObject("nodes",{filterDuplicates:!1},{projectUuid:r.uuid})}).then(function(e){u.update(e)}).then(u.connect).then(u.authenticate).then(u.getRelatedPeers).then(function(e){a.update(e)}).then(a.connectToNeighbourPeers).done(function(){logger.log("Network","Start complete")}),void 0):(logger.warn("Network","not starting, no internet-connection."),void 0)},stop:function(){},broadcast:function(e,t){u.list.forEach(function(n){n.send(e,t)}),a.broadcast(e,t)}})}),define("muskepeer-client",["lodash","./computation/index","./crypto/index","./network/index","./project","./settings","./storage/index"],function(e,t,n,r,i,o,s){function u(){var e=[{name:"JSON",test:JSON},{name:"Blob",test:Blob},{name:"localStorage",test:localStorage},{name:"indexedDB",test:indexedDB},{name:"GeoLocation API",test:navigator.geolocation},{name:"WebRTC API",test:window.mozRTCPeerConnection||window.webkitRTCPeerConnection||RTCPeerConnection},{name:"Object.observe",test:Object.observe},{name:"FileSystem API",test:navigator.webkitPersistentStorage||window.webkitStorageInfo}],t=[],n={isCompatible:!1,missingFeatures:[],missingRequirements:[]};return e.forEach(function(e){e.test||n.missingRequirements.push(e.name)}),t.forEach(function(e){e.test||n.missingFeatures.push(e.name)}),n.isCompatible=0===n.missingRequirements.length,n}return{computation:t,crypto:n,network:r,project:i,settings:o,storage:s,init:function(){try{var e=u();if(!e.isCompatible){var t="The following features are required but not supported by your browser: "+e.missingRequirements.join("\n");window.alert(t)}}catch(n){window.alert("Your browser is not supported.")}return this},start:function(t){return i=e.defaults(i,t.project),s.init().then(function(){return t.nodes.forEach(function(e){e.uuid=n.hash(e.host+e.port)}),s.db.saveMultiple("nodes",t.nodes,{allowDuplicates:!1,uuidIsHash:!0})}).then(function(){r.start(),s.fs.add(i.files).then(function(){return s.fs.downloadIncompleteFiles()}).then(function(){logger.log("DONE!")})}),this},stop:function(){return this.computation.stop(),this.network.stop(),this}}}),define("util/logger",[],function(){function e(){var e=new Date,t=[],n=e.getHours()<10?"0"+e.getHours():e.getHours(),r=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),i=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds();return t.push(n),t.push(r),t.push(i),t.join(":")}function t(t,n){1===n.length?console[t](e(),n[0]):2===n.length?console[t](e(),n[0]+":",n[1]):3===n.length?console[t](e(),n[0],n[1],":",n[2]):4===n.length?console[t](e(),n[0],n[1],":",n[2],n[3]):console[t](e(),n)}return{log:function(){t("log",arguments)},warn:function(){t("warn",arguments)},error:function(){t("error",arguments)}}}),define("domready",[],function(){function e(e){var t;for(t=0;t<e.length;t+=1)e[t](c)}function t(){var t=l;a&&t.length&&(l=[],e(t))}function n(){a||(a=!0,s&&clearInterval(s),t())}function r(e){return a?e(c):l.push(e),r}var i,o,s,u="undefined"!=typeof window&&window.document,a=!u,c=u?document:null,l=[];if(u){if(document.addEventListener)document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1);else if(window.attachEvent){window.attachEvent("onload",n),o=document.createElement("div");try{i=null===window.frameElement}catch(f){}o.doScroll&&i&&window.external&&(s=setInterval(function(){try{o.doScroll(),n()}catch(e){}},30))}"complete"===document.readyState&&n()}return r.version="2.0.1",r.load=function(e,t,n,i){i.isBuild?n(null):r(n)},r}),require.config({paths:{domready:"lib/requirejs-domready/domReady",lodash:"lib/lodash/dist/lodash",eventemitter2:"lib/eventemitter2/lib/eventemitter2",idbwrapper:"lib/idbwrapper/idbstore","node-uuid":"lib/node-uuid/uuid",q:"lib/q/q",sjcl:"lib/sjcl/sjcl",sockjs:"lib/sockjs/sockjs"},shim:{sjcl:{exports:"sjcl"}}}),require(["muskepeer-client","util/logger","domready"],function(e,t){window.Muskepeer=e.init(),window.logger=t,e.start({project:{uuid:"2345678902765456789",title:"TestProject",description:"Here be dragons!",active:!0,owner:{email:"matthieholzer@gmx.de",name:"Matthieu Holzer",url:"http://www.matthieuholzer.de",publicKey:""},computation:{offlineAllowed:!0,hasDependingTasks:!1,hasFiniteTasks:!0,hasDataFiles:!1,validationIterations:-1,worker:{url:null,algorithm:""},jobs:{},results:{bundleSize:100,storages:[{enabled:!0,type:"rest",url:"http://www.parse.com",method:"post",params:{}}]}},network:{useGeoLocation:!0}},nodes:[{host:"node01-muskepeer.rhcloud.com",isSecure:!0,port:8443},{host:"node02-muskepeer.rhcloud.com",isSecure:!0,port:8443}]}),logger.log("Uuid",e.settings.uuid)}),define("main",function(){});
//# sourceMappingURL=main.js.map